<?xml version="1.0" encoding="UTF-8"?>
<?PowerDesigner AppLocale="UTF16" AutoAttach="FALSE" Code="SqlScripts" HasExtendedMetaClass="FALSE" ID="{B7D801F7-F636-440F-A57D-198B551F03C9}" LastModificationDate="1397715855" LibID="{B18A8271-9633-11D1-9914-006097355D9B}" Name="SqlScripts" Objects="208" Symbols="0" Type="{186C8AC3-D3DC-11D3-881C-00508B03C75C}" signature="XEM_XML" version="16.6.4.5517"?>
<!-- do not edit this file -->

<EXASET xmlns:a="attribute" xmlns:c="collection" xmlns:o="object">

<o:ExtendedModelDefinition Id="o1">
<a:ObjectID>B7D801F7-F636-440F-A57D-198B551F03C9</a:ObjectID>
<a:Name>SqlScripts</a:Name>
<a:Code>SqlScripts</a:Code>
<a:CreationDate>1229168576</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1369220727</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:LibraryID>B18A8271-9633-11D1-9914-006097355D9B</a:LibraryID>
<a:CheckGlobalScript>&#39;******************************************************************************
&#39;* Purpose:  This VB-Script holds global definitions shared by all the custom-
&#39;*            checks scripts of the model extension.
&#39;******************************************************************************

Option Explicit &#39; This is to ensure all used variables are defined

function GetShortcutObject(obj)
   if obj is nothing then
      set GetShortcutObject = nothing
   elseif obj.ObjectType = &quot;ShortcutBase&quot; or obj.ObjectType = &quot;Shortcut&quot; then 
      obj.LoadObject()
      set GetShortcutObject = obj.TargetObject
   else
      set GetShortcutObject = obj
   end if
end function</a:CheckGlobalScript>
<c:Categories>
<o:TargetCategory Id="o2">
<a:ObjectID>053F0149-6236-4383-ABC8-1D7604B204D8</a:ObjectID>
<a:Name>Generation</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
</o:TargetCategory>
<o:ProfileTargetItem Id="o3">
<a:ObjectID>2F32DF72-65B1-4CEB-999E-5D67EFC6EE9E</a:ObjectID>
<a:Name>Profile</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1397715855</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TargetCategory Id="o4">
<a:ObjectID>E3BD050C-C546-4D53-A5BF-B8E81B4B4DF2</a:ObjectID>
<a:Name>Shared</a:Name>
<a:Code>Shared</a:Code>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o5">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>61D28B90-5493-4B60-BE0B-B372C02A5525</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1496989921</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o6">
<a:ObjectID>C3E742E0-CFE4-41AF-97ED-70CA6F9ED365</a:ObjectID>
<a:Name>SQLComment</a:Name>
<a:TemplateTargetItem.Value>.replace(&quot;&#39;&quot;,&quot;&#39;&#39;&quot;)
%Comment%
.endreplace</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o7">
<a:ObjectID>B34F3361-53DC-48DE-A98B-7A102EF08816</a:ObjectID>
<a:Name>Year</a:Name>
<a:TemplateTargetItem.Value>.vbscript(%*@1%)
   Dim splt
   splt = Split(ScriptInputArray(0), &quot; &quot;)
   ScriptResult = splt(2)
.endvbscript</a:TemplateTargetItem.Value>
<a:CreationDate>1364446574</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364447024</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o8">
<a:ObjectID>FB98CECA-2709-406F-BBEE-561AD05A8532</a:ObjectID>
<a:Name>JoinDataReferenceTemplate</a:Name>
<a:TemplateTargetItem.Value>.if (%CustomJoinData% != &quot;&quot;) and (%JoinDataByReference%)
%CustomJoinData%
.elsif (%GetChildColumn.Code% != &quot;refHistory&quot;) and (%JoinDataByReference%)
   .if(%ChildTable.IsPeriodHistory%)
set @context = Cast(&#39;disable dbo.%ChildTable.Code%_PeriodHistory&#39; as varbinary(max))
SET CONTEXT_INFO @context\n\n
   .elsif(%ChildTable.IsKeepIdHistory%)
set @context = Cast(&#39;disable dbo.%ChildTable.Code%_History&#39; as varbinary(max))
SET CONTEXT_INFO @context\n\n
   .else
SET CONTEXT_INFO 0x0\n\n
   .endif
update %ChildTable.Code% 
set %GetChildColumn.Code% = @idRecordTo
output deleted.id into @ids
from (select top (@countUpdates) id from %ChildTable.Code% where %GetChildColumn.Code% = @idRecordFrom) as p
where %ChildTable.Code%.id = p.id
 
if exists(select * from @ids)
begin
    insert into @result (ReferenceToTableName, TableNameUpdated, ColumnNameUpdated, RowsCountUpdated, RowsIDUpdated, IDFrom, IDTo)
    select &#39;%Outer.Code%&#39;, &#39;%ChildTable.Code%&#39;, &#39;%GetChildColumn.Code%&#39;, Count(*), dbo.Concatenate(cast(id as nvarchar(20))), @idRecordFrom, @idRecordTo
    from @ids d

    select *
    from @result

    return
end
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1496989805</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1496989921</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:TargetCategory>
<o:MetaClassTargetItem Id="o9">
<a:ObjectID>922D9797-9011-43A0-B5E5-6DD6D5537606</a:ObjectID>
<a:Name>Table</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1391148930</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o10">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>5374E015-D9E3-4C80-BC57-262B61F63650</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1387787494</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o11">
<a:ObjectID>C651FAE2-1FA2-4EC1-B780-11CBF4F78FA1</a:ObjectID>
<a:Name>DeleteProcedureWith_isDel</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N&#39;\[dbo].\[Delete_%Code%]&#39;) AND type in (N&#39;P&#39;, N&#39;PC&#39;))
DROP PROCEDURE [dbo].[Delete_%Code%]
GO

CREATE procedure [dbo].[Delete_%Code%] (@id bigint)
as
begin
.foreach_item(OutReferences,\n,\n)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
	exec Insert_%ParentTable.Code%_History @id
   .endif
.next(\n)

	update %Code%
	set isDel = 1
	where id = @id
end

GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o12">
<a:ObjectID>09351AA5-BDA5-4B1A-B8F7-B906BCD0F61A</a:ObjectID>
<a:Name>UpdateTriggerWith_keepIdHistory</a:Name>
<a:TemplateTargetItem.Value>.set_value(key,%PrimaryKey.Columns.First.Code%, new)
IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_History]&#39;))
DROP TRIGGER [dbo].[%Code%_History]
GO

CREATE TRIGGER [%Code%_History] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
FOR UPDATE
AS
BEGIN
   if cast(CONTEXT_INFO() as varchar(max)) = &#39;disable dbo.%Code%_History&#39;
      return

   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

	  /* Тело триггера */  
	DECLARE @id bigint
	DECLARE @isDel int  

.//ifnot(%IsChildOneToOne%)

/*Начало добавление*/
    if (not UPDATE (dateChange))
    BEGIN
		SET @id = (
				     SELECT MIN(id)
				     FROM DELETED)                                       
		WHILE (@id IS NOT NULL)
		BEGIN       

        declare @disableTrigger varbinary(max) = Cast(&#39;disable dbo.%Code%_History_Insert&#39; as varbinary(max))
        set CONTEXT_INFO @disableTrigger

			 insert into %Code%(
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == %key%) or (%Code% == &quot;refHistory&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)
, refHistory)
			 select 
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == %key%) or (%Code% == &quot;refHistory&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)
, id
			 from DELETED
			 where id = @id;
	/*Дочки Begin*/
.set_value(ref,&quot;&quot;,new)
.foreach_item(InReferences,\n			declare @ref bigint\n			set @ref = IDENT_CURRENT(&#39;%Code%&#39;)\n\n,\n)
   .if(%ChildTable.IsKeepIdHistory%) and (%ChildTable.Code% != %ParentTable.Code%)
			insert into %ChildTable.Code%(%Joins.First.ChildTableColumn.Code%, refHistory,
      .set_value(ref,%Joins.First.ChildTableColumn.Code%)
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == %key%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %ref%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)
)
			select @ref, refHistory,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == %key%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %ref%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)

			from %ChildTable.Code%
			where %Joins.First.ChildTableColumn.Code% = @id

      .if (%IsOneToOne% == false)

			delete from %ChildTable.Code%
			where %Joins.First.ChildTableColumn.Code% = @id and refHistory &lt;&gt; id
      .endif
   .endif
.next(\n\n)

   /*Дочки End*/
			SET @id =
				(SELECT MIN(id) FROM DELETED WHERE id &gt; @id) 
		END
	END
/*Конец добавление*/
.//endif

	SET @id = (        
			   SELECT MIN(id)
			   FROM INSERTED)          
	WHILE (@id IS NOT NULL)
	BEGIN     

.foreach_item(InReferences,%UpdateTriggerWith_keepIdHistory_isDelStart%\n,\n		 END\n)
   .if(%ChildTable.IsKeepIdHistory%) and (%ChildTable.Code% != %ParentTable.Code%)
				update %ChildTable.Code%
				set isDel = @isDel
				where %Joins.First.ChildTableColumn.Code% = @id
   .endif
.next(\n\n)
		/*dateChange*/
		if (not UPDATE (dateChange))
		BEGIN   
			update %Code%
			set dateChange = @dc
			where id = @id 
		END
	   SET @id = (SELECT MIN(id) FROM INSERTED WHERE id &gt; @id)
	END
END

GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1564391929</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o13">
<a:ObjectID>31FB7565-0262-4CB1-846B-6CE0391D07E8</a:ObjectID>
<a:Name>InsertProcedureHistory</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N&#39;[dbo].[Insert_%Code%_History]&#39;) AND type in (N&#39;P&#39;, N&#39;PC&#39;))
DROP PROCEDURE [dbo].[Insert_%Code%_History]
GO

CREATE procedure [dbo].[Insert_%Code%_History] (@id bigint)
as
begin
   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

	insert into %Code% (
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;)
 \[%Code%]
         .endif
      .next(,)
, refHistory, dateChange)
	select 
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;)
item.\[%Code%]
         .endif
      .next(,)
, item.id, @dc
	from %Code% item
	where item.id = @id

	declare @ref bigint
	set @ref = Scope_Identity()

.foreach_item(InReferences,\n,\n)
   .if(%IsOneToOne%) and (%ChildTable.IsKeepIdHistory%)

      .set_value(first,%ChildTable.PrimaryKey.Columns.First.Code%, new)
	insert into %ChildTable.Code% (%first%, 
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == &quot;dateChange&quot;)
 \[%Code%]
         .endif
      .next(,)
, refHistory, dateChange)
	select @ref,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == &quot;dateChange&quot;)
 item.\[%Code%]
         .endif
      .next(,)
, item.id, @dc
	from %ChildTable.Code% item
	where item.id = @id
   
   .endif
.next(\n)

end

GO
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1424428587</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o14">
<a:ObjectID>943ED75A-4152-42C6-B427-A1A3535AE697</a:ObjectID>
<a:Name>InsertProcedure</a:Name>
<a:TemplateTargetItem.Value>.set_value(key,%PrimaryKey.Columns.First.Code%, new)
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N&#39;[dbo].[Insert_%Code%]&#39;) AND type in (N&#39;P&#39;, N&#39;PC&#39;))
DROP PROCEDURE [dbo].[Insert_%Code%]
GO

CREATE procedure [dbo].[Insert_%Code%](
.foreach_item(Columns,,)
 @%Code% %DataType%
.next(,)
)
as
begin
.foreach_item(OutReferences,\n,\n)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
	exec Insert_%ParentTable.Code%_History @id
   .endif
.next(\n)
.//   exec Insert_%Code%_History @id

   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

.//.foreach_item(InReferences,\n,\n)
.//   .if(%ChildTable.IsKeepIdHistory%) and (%ChildTable.Code% != %ParentTable.Code%) and (%IsOneToOne%)
	if ((select id from %Code% where id = @id) is not null)
	begin
		update %Code%
		set	
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;) or (%Code% == %key%)
 \[%Code%] = @%Code%
         .endif
      .next(,)
, dateChange = @dc
		where %key% = @%key%
	end
	else
	begin
		insert into %Code% (
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;)
 \[%Code%]
         .endif
      .next(,)
, dateChange)
		values (
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;)
 @%Code%
         .endif
      .next(,)
, @dc)
	end
.//   .endif
.//.next(\n\n)

end

GO
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1424428587</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o15">
<a:ObjectID>BF913D33-2126-49AC-906D-C89188B45CB1</a:ObjectID>
<a:Name>UpdateProcedure</a:Name>
<a:TemplateTargetItem.Value>.set_value(key,%PrimaryKey.Columns.First.Code%, new)
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N&#39;[dbo].[Update_%Code%]&#39;) AND type in (N&#39;P&#39;, N&#39;PC&#39;))
DROP PROCEDURE [dbo].[Update_%Code%]
GO

CREATE procedure [dbo].[Update_%Code%] (
.foreach_item(Columns,,)
 @%Code% %DataType%
.next(,)
)
as
begin
.foreach_item(OutReferences,\n,\n)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
	exec Insert_%ParentTable.Code%_History @id
   .endif
.next(\n)

   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

	update %Code%
	set	
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;) or (%Code% == %key%)
 \[%Code%] = @%Code%
         .endif
      .next(,)
, dateChange = @dc
	where id = @id
end

GO
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1424428587</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o16">
<a:ObjectID>4C0B4FAD-AF3F-49AC-BEFE-8C5104496786</a:ObjectID>
<a:Name>UpdateTriggerWith_keepIdHistory_isDelStart</a:Name>
<a:TemplateTargetItem.Value>         /*isdel*/
         if (UPDATE (isdel))
         BEGIN 
         	set @isDel = (
         				  SELECT isDel
         				  FROM INSERTED
         				  WHERE id = @id)
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o17">
<a:ObjectID>90453E7A-06A3-473A-8F13-83F51132538A</a:ObjectID>
<a:Name>Scripts</a:Name>
<a:TemplateTargetItem.Value>.if(%IsKeepIdHistory%)
%DeleteTriggerWith_isDel%

   .ifnot(%IsChildOneToOne%)

%UpdateTriggerWith_keepIdHistory%

%InsertTrigger_History%
   .else

%InsertTrigger_HistoryOneToOne%

%UpdateTrigger_HistoryOneToOne%
   .endif

.endif


.if(%IsPeriodHistory%)
%UpdateTriggerPeriodHistory%

%DeleteTriggerPeriodHistory%
.endif

%UniqueCode%</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o18">
<a:ObjectID>59FDAE98-2780-4DE8-B00B-3062B7996488</a:ObjectID>
<a:Name>DeleteTriggerWith_isDel</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_isDel]&#39;))
DROP TRIGGER [dbo].[%Code%_isDel]
GO

CREATE TRIGGER [dbo].[%Code%_isDel] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
INSTEAD OF DELETE
AS
BEGIN
   .if (%IsKeepIdHistoryOnlySelf%)

   declare @disableTrigger varbinary(max) = Cast(&#39;disable dbo.%Code%_History&#39; as varbinary(max))
   set CONTEXT_INFO @disableTrigger

   .endif

   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

   DECLARE @id bigint
   DECLARE @isDel int  
   DECLARE @refHistory bigint     
   
   SELECT @id = MIN(id) FROM DELETED
   
   WHILE @id IS NOT NULL
   BEGIN
      SELECT @isDel = isDel, @refHistory = refHistory
      FROM DELETED 
      WHERE id = @id

      if @id &lt;&gt; @refHistory
      begin
         delete from %Code% where id = @id
      end
      else if @isDel = 0
      begin
         update %Code%
         set isDel = 1, dateChange = @dc
         where id = @id
      end
      else if @id = @refHistory
      begin
         update %Code%
         set isDel = 0, dateChange = @dc
         where id = @id
      end

      SELECT @id = MIN(id)
      FROM DELETED
      WHERE id &gt; @id
   END
END
GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1564459043</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o19">
<a:ObjectID>FA6BAF98-CC01-468B-A819-ED795DF6B9C5</a:ObjectID>
<a:Name>InsertTrigger_History</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_History_Insert]&#39;))
DROP TRIGGER [dbo].[%Code%_History_Insert]
GO

CREATE TRIGGER [%Code%_History_Insert] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
FOR INSERT
AS
BEGIN
   if cast(CONTEXT_INFO() as varchar(max)) = &#39;disable dbo.%Code%_History_Insert&#39;
      return

	  /* Тело триггера */  
	DECLARE @id bigint
	DECLARE @isDel int  
	DECLARE @refHistory bigint; 

/*Начало добавление*/
		SET @id = (
				     SELECT MIN(id)
				     FROM INSERTED)                                                            
		WHILE (@id IS NOT NULL)
		BEGIN 
		SET @refHistory = (
				     SELECT refHistory
				     FROM INSERTED
                     where id=@id)  

.foreach_item(InReferences,%InsertTrigger_History_Conditions_Start%\n,%InsertTrigger_History_Conditions_Close%)
   .if(%IsOneToOne% == false) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)

      .set_value(first,%ChildTable.PrimaryKey.Columns.First.Code%, new)
      .set_value(childCode,%Joins.First.ChildTableColumn.Code%, new)
	        insert into %ChildTable.Code% (%childCode%, refHistory,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 \[%Code%]
         .endif
      .next(,)
)
	        select @id, item.refHistory, 
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 item.\[%Code%]
         .endif
      .next(,)

	        from %ChildTable.Code% item
	        where item.%childCode% = @refHistory

	        delete from %ChildTable.Code%
	        where %childCode% = @refHistory and id &lt;&gt; refHistory

   .endif
.next(\n)

			SET @id =
				(SELECT MIN(id) FROM INSERTED WHERE id &gt; @id) 
		END; 
/*Конец добавление*/
END
GO
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1564392092</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o20">
<a:ObjectID>257096F7-7361-4437-859F-0D615D06E628</a:ObjectID>
<a:Name>InsertTrigger_HistoryOneToOne</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_History_Insert]&#39;))
DROP TRIGGER [dbo].[%Code%_History_Insert]
GO

CREATE TRIGGER [%Code%_History_Insert] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
INSTEAD OF INSERT
AS
BEGIN
  /* Тело триггера */   
DECLARE @id bigint
DECLARE @refHistory bigint  
SET @id = (
				     SELECT MIN(id)
				     FROM INSERTED)                                                         
		WHILE (@id IS NOT NULL)
		BEGIN
		SET @refHistory = (
				     SELECT refHistory
				     FROM INSERTED
                     where id=@id)                        

   declare @dc datetime = GetDate()
   set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

	if ((select id from %Code% where id = @id) is not null)
    begin

.foreach_item(OutReferences,\n,\n)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
        insert into %ParentTable.Code%(
      .foreach_item(ParentTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;id&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;)
 \[%Code%]
         .endif
      .next(,)
, refHistory, dateChange)
        select 
      .foreach_item(ParentTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;id&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;)
 item.\[%Code%]
         .endif
      .next(,)
, item.id, @dc
        from %ParentTable.Code% item
        where item.id = @id

        declare @ref bigint
        set @ref = IDENT_CURRENT(&#39;%ParentTable.Code%&#39;)
   .endif
.next(\n)

        
        insert into %Code%(id, refHistory,
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
)
        select @ref, id, 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
        from %Code%
        where id = @id; 

        /*Дочки Begin*/

.foreach_item(InReferences,\n,\n)
   .if(%IsOneToOne% == false) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)

      .set_value(first,%ChildTable.PrimaryKey.Columns.First.Code%, new)
      .set_value(childCode,%Joins.First.ChildTableColumn.Code%, new)
	     insert into %ChildTable.Code% (%childCode%, refHistory,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 \[%Code%]
         .endif
      .next(,)
)
	     select @ref, id, 
      .foreach_item(ChildTable.Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 item.\[%Code%]
         .endif
      .next(,)
	     from %ChildTable.Code% item
	     where item.%childCode% = @id
   
   .endif
.next(\n)

        /*Дочки End*/   
        
        update %Code%
        set 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%] = item.\[%Code%]
         .endif
      .next(,)
        from INSERTED item
		  where item.id = @id and %Code%.id = @id        
    end        
    else
    begin   
        /*insert into %Code%(id, refHistory, 
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
)
        select @id, id, 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
        from %Code%
        where id = @id;*/ 
  
        insert into %Code%(id, refHistory, 
      .foreach_item(Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
)
        select @id, coalesce(refHistory, @id), 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;)
 \[%Code%]
         .endif
      .next(,)
        from INSERTED
        where id = @id   
        
        /*Дочки Begin*/

.foreach_item(InReferences,\n,\n)
   .if(%IsOneToOne% == false) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)

      .set_value(first,%ChildTable.PrimaryKey.Columns.First.Code%, new)
      .set_value(childCode,%Joins.First.ChildTableColumn.Code%, new)
	    insert into %ChildTable.Code% (%childCode%, refHistory,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 \[%Code%]
         .endif
      .next(,)
)
	    select @id, id, 
      .foreach_item(ChildTable.Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%)
 item.\[%Code%]
         .endif
      .next(,)
	    from %ChildTable.Code% item
	    where item.%childCode% = @refHistory
   
   .endif
.next(\n)

        /*Дочки End*/        
	end                        
			SET @id =
				(SELECT MIN(id) FROM INSERTED WHERE id &gt; @id)                 
		END                          
END
GO
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1562042427</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o21">
<a:ObjectID>D6D1AA98-A7EA-4A26-9461-CF169146446C</a:ObjectID>
<a:Name>UpdateTrigger_HistoryOneToOne</a:Name>
<a:TemplateTargetItem.Value>IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_History_Update]&#39;))
DROP TRIGGER [dbo].[%Code%_History_Update]
GO

CREATE TRIGGER [%Code%_History_Update] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
INSTEAD OF UPDATE
AS
BEGIN
    if cast(CONTEXT_INFO() as varchar(max)) = &#39;disable dbo.%Code%_History_Update&#39;
    begin
        update %Code%
        set 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;) or (%Code% == &quot;id&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
\[%Code%] = item.\[%Code%]
         .endif
      .next(&quot;, &quot;)
        from INSERTED item
		  where item.id = %Code%.id

        return
    end

  /* Тело триггера */
DECLARE @id bigint  
DECLARE @refHistory bigint  
DECLARE @isDel int  
    
if (not UPDATE (dateChange))
BEGIN

		SET @id = (
				     SELECT MIN(id)
				     FROM DELETED)                                                         

      declare @dc datetime = GetDate()
      set @dc = DateAdd(ms, -DatePart(ms, @dc), @dc)

		WHILE (@id IS NOT NULL)
		BEGIN
		SET @refHistory = (
				     SELECT refHistory
				     FROM DELETED
                     where id=@id) 

.foreach_item(OutReferences,\n,)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
        insert into %ParentTable.Code%(
      .foreach_item(ParentTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;id&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)
, refHistory, dateChange)
        select 
      .foreach_item(ParentTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;id&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;dateChange&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
 item.\[%Code%]
         .endif
      .next(,)
, item.id, @dc
        from %ParentTable.Code% item
        where item.id = @id
             
        declare @ref bigint
        set @ref = IDENT_CURRENT(&#39;%ParentTable.Code%&#39;)
   .endif
.next(\n)
        
.foreach_item(OutReferences,,)
   .if(%IsOneToOne%) and (%ParentTable.IsKeepIdHistory%)
      .foreach_item(ParentTable.InReferences,,)
         .if(%IsOneToOne%) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)

        insert into %ChildTable.Code%(id, refHistory,
            .foreach_item(ChildTable.Columns,,)
               .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
               .endif
            .next(,)
)
        select @ref, id, 
            .foreach_item(ChildTable.Columns,,\n)
               .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
               .endif
            .next(,)
        from %ChildTable.Code%
        where id = @id; 
         .endif
      .next(\n)
   .endif
.next(\n)

        /*Дочки Begin*/

.foreach_item(InReferences,\n,)
   .if(%IsOneToOne% == false) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)

      .set_value(first,%ChildTable.PrimaryKey.Columns.First.Code%, new)
      .set_value(childCode,%Joins.First.ChildTableColumn.Code%, new)
	     insert into %ChildTable.Code% (%childCode%, refHistory,
      .foreach_item(ChildTable.Columns,,)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%]
         .endif
      .next(,)
)
	     select @ref, id, 
      .foreach_item(ChildTable.Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;refHistory&quot;) or (%Code% == %first%) or (%Code% == %childCode%) or (%.L:DataType% == &quot;timestamp&quot;)
 item.\[%Code%]
         .endif
      .next(,)
	     from %ChildTable.Code% item
	     where item.%childCode% = @id
   
   .endif
.next(\n)

        /*Дочки End*/   
        
        update %Code%
        set 
      .foreach_item(Columns,,\n)
         .ifnot(%Identity%) or (%Code% == &quot;dateChange&quot;) or (%Code% == &quot;refHistory&quot;) or (%Code% == &quot;id&quot;) or (%.L:DataType% == &quot;timestamp&quot;)
 \[%Code%] = item.\[%Code%]
         .endif
      .next(,)
        from INSERTED item
		  where item.id = @id and %Code%.id = @id
                
			SET @id =
				(SELECT MIN(id) FROM DELETED WHERE id &gt; @id)                 
		END 
END        
/*---------------------INSERTED-------------------------*/                              
	SET @id = (        
			   SELECT MIN(id)
			   FROM INSERTED)          
	WHILE (@id IS NOT NULL)
	BEGIN     
         /*isdel*/
         if (UPDATE (isdel))
         BEGIN 
         	set @isDel = (
         				  SELECT isDel
         				  FROM INSERTED
         				  WHERE id = @id)

.foreach_item(InReferences,\n,\n)
   .if(%IsOneToOne% == false) and (%ChildTable.IsKeepIdHistory%) and (%Joins.First.ChildTableColumn.Code% != &quot;refHistory&quot;)
      .set_value(childCode,%Joins.First.ChildTableColumn.Code%, new)
				update %ChildTable.Code%
				set isDel = @isDel
				where %childCode% = @id
   .endif
.next(\n\n)

		 END
		/*dateChange*/
		if (not UPDATE (dateChange))
		BEGIN   
			update %Code%
			set dateChange = @dc
			where id = @id 
		END
	   SET @id = (SELECT MIN(id) FROM INSERTED WHERE id &gt; @id)
	END
END
GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1562041452</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o22">
<a:ObjectID>892558D3-C5D0-4ADE-B2CB-3A411657635A</a:ObjectID>
<a:Name>InsertTrigger_History_Conditions_Start</a:Name>
<a:TemplateTargetItem.Value>        if (@refHistory&lt;&gt;@id)AND(@refHistory is not null)      
        begin 
        /*Дочки кроме дочек один к одному*/</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o23">
<a:ObjectID>DFE28AAF-A7DA-490E-8F92-1941AEAD913F</a:ObjectID>
<a:Name>InsertTrigger_History_Conditions_Close</a:Name>
<a:TemplateTargetItem.Value>     /*Дочки кроме дочек один к одному*/                     
        end</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o24">
<a:ObjectID>EBD6E7E0-591E-494A-8694-0D05163944B2</a:ObjectID>
<a:Name>UpdateTriggerPeriodHistory</a:Name>
<a:TemplateTargetItem.Value>.set_value(key,%PrimaryKey.Columns.First.Code%, new)
.set_value(ccode,%HasCCode%,new)
.set_value(isTree,%HasRefParent%,new)
IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_PeriodHistory]&#39;))
DROP TRIGGER [dbo].[%Code%_PeriodHistory]
GO

CREATE TRIGGER [%Code%_PeriodHistory] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
INSTEAD OF UPDATE
AS
BEGIN
   declare @currentDate datetime = GetDate()
   set @currentDate = DateAdd(ms, -DatePart(ms, @currentDate), @currentDate)

   if cast(CONTEXT_INFO() as varchar(max)) = &#39;disable dbo.%Code%_PeriodHistory&#39;
   begin
      update %Code% set 
.foreach_item(Columns,,\n)
   .if (%.L:Code% != &quot;refhistory&quot;) and (%.L:Code% != &quot;refhistorycopy&quot;) and (%.L:Code% != &quot;ccode&quot;) and (%Code% != %key%) and (%Computed% == false) and (%.L:Code% != &quot;dateend&quot;) and (%.L:Code% != &quot;datestart&quot;) and (%.L:DataType% != &quot;timestamp&quot;)
%Code% = i.%Code%
   .endif
.next(&quot;, &quot;)
      from INSERTED i
      where %Code%.%key% = i.%key%
   	return
   end

   declare @updated table 
   (
      oldId bigint,
      newId bigint,
      dateEnd datetime
   );
   --обновление даты конца и кодов если нет других изменений
   UPDATE %Code% SET dateEnd = INSERTED.dateEnd
.if(%HasCode%)
, code = INSERTED.code
.endif
.if(%ccode%)
, ccode = INSERTED.ccode
.endif

   OUTPUT DELETED.id, null, INSERTED.dateEnd into @updated
   FROM INSERTED
   WHERE (INSERTED.id = %Code%.id) and %Code%.dateEnd is null
   .foreach_item(Columns,&quot; and &quot;,\n)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%.L:Code% == &quot;code&quot;) or (%.L:Code% == &quot;ccode&quot;) or (%Code% == %key%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
         .if (%.L:DataType% == &quot;xml&quot;)
1 = 1 /* &#39;%Code%&#39; xml data not comparable */
         .elsif (%Mandatory%)
INSERTED.%Code% = %Parent.Code%.%Code%
         .else
(INSERTED.%Code% = %Parent.Code%.%Code% or (INSERTED.%Code% is null and %Parent.Code%.%Code% is null))
         .endif
      .endif
   .next(&quot; and &quot;)

.if(%isTree%)
   --сбор дочерних записей по дереву
   declare @childsRows table
   (
      dicId bigint
      , dateStart datetime
      , nextId bigint
      , isParent bit
      , refHistory bigint
[%HasWeight%?      , FullWeight varchar(450)]
   );
   WITH x (id, dateStart, isParent, refHistory[%HasWeight%?, FullWeight]) AS 
   (
      SELECT INSERTED.id
          , case when INSERTED.dateStart &lt;&gt; DELETED.dateStart 
               then INSERTED.dateStart
               else @currentDate
          end as dateStart
          , 1 as isParent
          , DELETED.refHistory
[%HasWeight%?          , REPLICATE(&#39;0&#39;, 10 - Len(Cast(INSERTED.Weight as nvarchar(450)))) + Cast(INSERTED.Weight as nvarchar(450))]
      FROM INSERTED
         JOIN DELETED ON INSERTED.ID = DELETED.ID
      WHERE DELETED.dateEnd is null
      .foreach_item(Columns,&quot; and (&quot;,&quot;)\n&quot;)
         .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%.L:Code% == &quot;code&quot;) or (%Code% == %key%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
            .if (%.L:DataType% == &quot;xml&quot;)
1 = 1 /* &#39;%Code%&#39; xml data not comparable */
            .elsif (%Mandatory%)
   INSERTED.%Code% &lt;&gt; DELETED.%Code%
            .else
   (INSERTED.%Code% &lt;&gt; DELETED.%Code% or (INSERTED.%Code% is null and DELETED.%Code% is not null) or (INSERTED.%Code% is not null and DELETED.%Code% is null))
            .endif
         .endif
      .next(&quot; or &quot;)
      UNION ALL
      SELECT e.id
          , x.dateStart
          , 0 as isParent
          , e.refHistory
[%HasWeight%?          , x.FullWeight + REPLICATE(&#39;0&#39;, 10 - Len(Cast(e.Weight as nvarchar(450)))) + Cast(e.Weight as nvarchar(450))]
      FROM %Code% e, x
      WHERE e.refParent = x.id and dateEnd is null
   )

   --сбор дочерних записей которые нужно скопировать
   insert into @childsRows (dicId, dateStart, isParent, refHistory[%HasWeight%?, FullWeight])
   select x.id , x.dateStart, x.isParent, refHistory[%HasWeight%?, FullWeight]
   from x

.endif

   --обновление даты конца записям у котрых были изменеия полей
   UPDATE %Code% SET dateEnd = case when INSERTED.dateStart &lt;&gt; %Code%.dateStart 
                                    then INSERTED.dateStart
                                    else @currentDate
                               end
   FROM INSERTED
   WHERE (INSERTED.id = %Code%.id) and %Code%.dateEnd is null

   .foreach_item(Columns,&quot; and (&quot;,&quot;)\n&quot;)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%.L:Code% == &quot;code&quot;) or (%.L:Code% == &quot;ccode&quot;) or (%Code% == %key%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
         .if (%.L:DataType% == &quot;xml&quot;)
1 = 1 /* &#39;%Code%&#39; xml data not comparable */
         .elsif(%Mandatory%)
INSERTED.%Code% &lt;&gt; %Parent.Code%.%Code%
         .else
(INSERTED.%Code% &lt;&gt; %Parent.Code%.%Code% or (INSERTED.%Code% is null and %Parent.Code%.%Code% is not null) or (INSERTED.%Code% is not null and %Parent.Code%.%Code% is null))
         .endif
      .endif
   .next(&quot; or &quot;)

.if(%isTree%)

   --обновление даты конца дочерним записям
   UPDATE %Code% SET dateEnd = x.dateStart
   FROM @childsRows x
   WHERE (x.dicId = %Code%.id)

.endif

   --вставляем запись, которая шла на обновление
   INSERT INTO %Code%(
.if (%isTree%)
refHistoryCopy, 
.endif
refHistory, dateStart
   .foreach_item(Columns,&quot;, &quot;,&quot;)\n&quot;)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%Code% == %key%) or (%.L:Code% == &quot;datestart&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
%Code%
      .endif
   .next(&quot;, &quot;)
   OUTPUT INSERTED.refHistory
.if (%isTree%)
Copy
.endif
, INSERTED.id, INSERTED.dateStart into @updated
   SELECT 
.if (%isTree%)
i.id, isnull(i.refHistory, i.id)
.else
IsNull(i.refHistory, i.id)
.endif
 as refHistory,
          case when i.dateStart &lt;&gt; d.dateStart 
               then i.dateStart
               else @currentDate
          end as dateStart,
   .foreach_item(Columns,\n,\n)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%Code% == %key%) or (%.L:Code% == &quot;datestart&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
i.%Code%
      .endif
   .next(&quot;, &quot;)
   FROM INSERTED i
      JOIN DELETED d ON i.ID = d.ID
   WHERE d.dateEnd is null
   .foreach_item(Columns,&quot; and (&quot;,&quot;)\n&quot;)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%.L:Code% == &quot;code&quot;) or (%Code% == %key%) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
         .if (%.L:DataType% == &quot;xml&quot;)
1 = 1 /*&#39;%Code%&#39;  xml data not comparable */
         .elsif(%Mandatory%)
i.%Code% &lt;&gt; d.%Code%
         .else
(i.%Code% &lt;&gt; d.%Code% or (i.%Code% is null and d.%Code% is not null) or (i.%Code% is not null and d.%Code% is null))
         .endif
      .endif
   .next(&quot; or &quot;)

.if(%isTree%)

   --вставляем дочернии записи
   INSERT INTO %Code%(refHistoryCopy, refHistory, refParent, dateStart
   .foreach_item(Columns,&quot;, &quot;,&quot;)\n&quot;)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;refparent&quot;) or (%Code% == %key%) or (%.L:Code% == &quot;datestart&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
%Code%
      .endif
   .next(&quot;, &quot;)
   OUTPUT INSERTED.refHistoryCopy, INSERTED.id, INSERTED.dateStart into @updated
   SELECT dic.id, isnull(dic.refHistory, dic.id) as refHistory,
          dic.refParent, x.dateStart,
   .foreach_item(Columns,\n,\n)
      .ifnot(%.L:Code% == &quot;refhistory&quot;) or (%.L:Code% == &quot;refhistorycopy&quot;) or (%.L:Code% == &quot;refparent&quot;) or (%Code% == %key%) or (%.L:Code% == &quot;datestart&quot;) or (%.L:Code% == &quot;dateend&quot;) or (%Computed%) or (%.L:DataType% == &quot;timestamp&quot;)
dic.%Code%
      .endif
   .next(&quot;, &quot;)
	FROM @childsRows x join %Code% as dic ON x.dicId = dic.id
   where x.isParent = 0
   [%HasWeight%?ORDER BY x.FullWeight]

	update @childsRows set nextId = dic.id
	from %Code% dic
	where dicId = dic.refHistoryCopy

	Update %Code% set refParent = x2\.nextId, refHistory = IsNull(x.refHistory, %Code%.refHistoryCopy)
	FROM @childsRows x, @childsRows x2
	where %Code%.refHistoryCopy = x.dicId and x2.dicId = %Code%.refParent

.endif



   update @updated set oldId = i.id
   from INSERTED i
   where i.refHistory
.if (%isTree%)
Copy
.endif
 = oldId

.set_value(_addedColumn,&quot;&quot;,new)
.foreach_line(%AllInReferenceChildTables%,\n)
   .set_value(_addedColumn,&quot;&quot;)
   .foreach_item(InReferences,&quot;   update %CurrentLine%\n   set dateStart = t.dateEnd&quot;,\n)
      .if(%ChildTable.Code% == %CurrentLine%) and (%ParentTable.Code% != %ChildTable.Code%) and (%.L4:ParentTable.Code% == %.L4:ChildTable.Code%) and (%ChildTable.IsPeriodHistory%)
         .if(%_addedColumn% == &quot;&quot;)
            .set_value(_addedColumn,%CurrentLine%.%Joins.First.ChildTableColumn.Code% = t.oldId)
         .else
            .set_value(_addedColumn,%_addedColumn% or %CurrentLine%.%Joins.First.ChildTableColumn.Code% = t.oldId)
         .endif
\n      , %Joins.First.ChildTableColumn.Code% = coalesce((select tu.newId from @updated tu where %CurrentLine%.%Joins.First.ChildTableColumn.Code% = tu.oldId), %Joins.First.ChildTableColumn.Code%)
      .endif
   .next
   .if(%_addedColumn% != &quot;&quot;)
   from @updated t
   where t.dateEnd is not null and %CurrentLine%.dateEnd is null and (%_addedColumn%)
   .endif
.next(\n\n)
.unset(_addedColumn)
[\n   %UpdateTriggerPeriodHistorySQLEnd%]
END

GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1486033123</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o25">
<a:ObjectID>EF3323C5-42EE-48FD-9062-4C147CF0916F</a:ObjectID>
<a:Name>DeleteTriggerPeriodHistory</a:Name>
<a:TemplateTargetItem.Value>.set_value(key,%PrimaryKey.Columns.First.Code%, new)
IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%Code%_PeriodHistoryDel]&#39;))
DROP TRIGGER [dbo].[%Code%_PeriodHistoryDel]
GO

CREATE TRIGGER [%Code%_PeriodHistoryDel] ON [dbo].[%Code%]
WITH EXECUTE AS CALLER
INSTEAD OF DELETE
AS
BEGIN
   declare @currentDate datetime = GetDate()
   set @currentDate = DateAdd(ms, -DatePart(ms, @currentDate), @currentDate)

   declare @updated table 
   (
      oldId bigint,
      dateEnd datetime
   );

.if(%HasRefParent%)
   WITH x (id) AS 
   (
      SELECT id FROM DELETED WHERE DELETED.dateEnd is null
      UNION ALL
      SELECT e.id FROM %Code% e, x
      WHERE e.refParent = x.id and e.dateEnd is null
   )
   UPDATE %Code% SET dateEnd = case when dateStart &lt; @currentDate then @currentDate else dateStart end
   OUTPUT DELETED.id, INSERTED.dateEnd INTO @updated
   FROM x
   WHERE (%Code%.id = x.id)
.else
   UPDATE %Code% Set dateEnd = case when DELETED.dateStart &lt; @currentDate then @currentDate else DELETED.dateStart end
   OUTPUT DELETED.id, INSERTED.dateEnd INTO @updated
   FROM DELETED
   WHERE DELETED.id = %Code%.id and DELETED.dateEnd is null
.endif

.foreach_item(InReferences,\n\n\n)
   .if(%ParentTable.Code% != %ChildTable.Code%) and (%.L4:ParentTable.Code% == %.L4:ChildTable.Code%) and (%ChildTable.IsPeriodHistory%)
   update %ChildTable.Code% set dateEnd = t.dateEnd
   from @updated t
   where %ChildTable.Code%.dateEnd is null and %ChildTable.Code%.%Joins.First.ChildTableColumn.Code% = t.oldId
   .endif
.next(\n\n)

END

GO</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1379053504</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o26">
<a:ObjectID>F5344F2B-8B77-410B-9C84-F81E692317C7</a:ObjectID>
<a:Name>UniqueCode</a:Name>
<a:TemplateTargetItem.Value>.if(%UniqueColumnName% != &quot;&quot;)
   .set_value(ErrorMessageCode,50007,new)
   .set_value(CodeColumn,%UniqueColumnName%,new)
   .set_value(TriggerName,%UniqueColumnName%,new)
.elsif(%HasCCode%)
   .set_value(ErrorMessageCode,50008,new)
   .set_value(CodeColumn,ccode,new)
   .set_value(TriggerName,Code,new)
.elsif(%HasCode%)
   .set_value(ErrorMessageCode,50007,new)
   .set_value(CodeColumn,code,new)
   .set_value(TriggerName,Code,new)
.else
   .set_value(ErrorMessageCode,50007,new)
   .set_value(CodeColumn,,new)
   .set_value(TriggerName,Code,new)
.endif
.if(%CodeColumn% != &quot;&quot;) and (%GenerateUniqueCode%)
   .set_value(TriggerName,%Code%_Unique%TriggerName%)
IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N&#39;[dbo].[%TriggerName%]&#39;))
DROP TRIGGER [dbo].[%TriggerName%]
GO

CREATE TRIGGER dbo.%TriggerName% on dbo.%Code%
WITH EXECUTE AS CALLER
FOR INSERT, UPDATE
AS
BEGIN\n
   .if (%IsPeriodHistory%)
   /* Тело триггера */
   IF UPDATE (%CodeColumn%)
   BEGIN
      DECLARE @id bigint
      DECLARE @countrow bigint  
      DECLARE @t1 datetime
      DECLARE @t2 datetime
      DECLARE @%CodeColumn% NVARCHAR(255)

      SELECT @id = MIN(id)
      FROM INSERTED

      WHILE (@id IS NOT NULL)
      BEGIN
         select @t1 = dateStart, @t2 = dateEnd, @%CodeColumn% = %CodeColumn%
         FROM INSERTED
         WHERE id = @id
         
         select @countrow = COUNT(*)
         from %Code% p1
              left JOIN %Code% p on p1.id = p.id and (((@t2 is not NULL) and (
              p.dateStart &gt;= @t2)) or ((p.dateEnd is not NULL) and (p.dateEnd &lt;= @t1)))
         where p1.%CodeColumn% = @%CodeColumn% AND
               p.id is null and
               p1.id &lt;&gt; @id

         if (@countrow &gt; 0) 
         begin
            raiserror (%ErrorMessageCode%, 16, 127)
            rollback transaction
            return
         end

         SELECT @id = MIN(id)
         FROM INSERTED
         WHERE id &gt; @id
      END
   END\n
   .else
   if exists(select * from %Code% t join Inserted i on i.%CodeColumn% = t.%CodeColumn% where t.id &lt;&gt; i.id)
   begin
      raiserror (%ErrorMessageCode%, 16, 127)
      rollback  transaction
      return
   end\n
   .endif
end
go
.endif
.unset(ErrorMessageCode)
.unset(CodeColumn)
.unset(TriggerName)
</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1387787760</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:Comment>%Code%_UniqueCode</a:Comment>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o27">
<a:ObjectID>788EBA10-D753-4C30-B06F-EEE2124A753B</a:ObjectID>
<a:Name>DropComputedColumns</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Columns)
   .if(%Computed%)
alter table %Parent.Code%
   drop column %Code%
go
   .endif
.next(\n\n)</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o28">
<a:ObjectID>A776AB24-15A0-4D00-B710-D44EBC303418</a:ObjectID>
<a:Name>AllInReferenceChildTables</a:Name>
<a:TemplateTargetItem.Value>.unique
   .foreach_item(InReferences)
%ChildTable.Code%
   .next(\n)
.endunique</a:TemplateTargetItem.Value>
<a:CreationDate>1301372648</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1301377954</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o29">
<a:ObjectID>62811BEC-1207-4229-93AD-BD149308D3DF</a:ObjectID>
<a:Name>JoinData</a:Name>
<a:TemplateTargetItem.Value>SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
 * Author:      %CurrentUser%
 * Create date: %%CreationDate%%
 * Modified at: %%ModificationDate%%
 * GeneratedAt: %CurrentDate%
 * Description: Актуализация ссылок на справочник %Code%
 * Copyright © %Model.CopyrightCompanyName% %%Year(CreationDate)%%
 */
CREATE PROCEDURE P_UpdateReferencesDataTo%Code%
    @idRecordFrom bigint, @idRecordTo bigint, @countUpdates int = 100
AS
BEGIN
    SET NOCOUNT ON;
    declare @rowCount bigint = 0, @context varbinary(max)
    declare @ids table
    (
        id bigint
    )
    declare @result table
    (
        RowsCountUpdated int,
        TableNameUpdated nvarchar(max),
        ColumnNameUpdated nvarchar(max),
        RowsIDUpdated nvarchar(max),
        ReferenceToTableName nvarchar(max),
        IDFrom nvarchar(max),
        IDTo nvarchar(max),
        Message nvarchar(max)
    )

.foreach_item(LinkShortcuts,\n\n,\n\n)
    %JoinDataReferenceTemplate%
.next(\n\n\n)

.foreach_item(InReferences,\n\n,\n\n)
    %JoinDataReferenceTemplate%
.next(\n\n\n)
	
    update %Code% 
    set dateEnd = GetDate()
    where id = @idRecordFrom and dateEnd is null

    select *
    from @result
END</a:TemplateTargetItem.Value>
<a:CreationDate>1335589016</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o30">
<a:ObjectID>9AC12FD4-FE33-449E-B9C9-AA039321EF38</a:ObjectID>
<a:Name>CheckForJoinData</a:Name>
<a:TemplateTargetItem.Value>SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
 * Author:      %CurrentUser%
 * Create date: %%CreationDate%%
 * Modified at: %%ModificationDate%%
 * GeneratedAt: %CurrentDate%
 * Description: Проверка наличия данных ссылающихся на значение справоника %Code%
 * Copyright © %Model.CopyrightCompanyName% %%Year(CreationDate)%%
 */
CREATE PROCEDURE P_ExistsReferencesDataTo%Code% 
    @idRecordFrom bigint
AS
BEGIN
    SET NOCOUNT ON;

.foreach_item(LinkShortcuts,\n,\n\n)
   .if (%GetChildColumn.Code% != &quot;refHistory&quot;) and (%JoinDataByReference%)
    if Exists(select * from %GetChildTable.Code% where %GetChildColumn.Code% = @idRecordFrom)
    begin
       select Cast(1 as bit) as DataExists
       return
    end
   .endif
.next(\n\n)
.foreach_item(InReferences,\n,\n\n)
   .if (%GetChildColumn.Code% != &quot;refHistory&quot;) and (%JoinDataByReference%)
    if Exists(select * from %GetChildTable.Code% where %GetChildColumn.Code% = @idRecordFrom)
    begin
       select Cast(1 as bit) as DataExists
       return
    end
   .endif
.next(\n\n)
    select Cast(0 as bit) as DataExists
END</a:TemplateTargetItem.Value>
<a:CreationDate>1335589016</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o31">
<a:ObjectID>317AC800-1E10-4924-AF65-7F24B3A14410</a:ObjectID>
<a:Name>uniqueColumnNameList</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Columns)
%Code%
.next(\n)</a:TemplateTargetItem.Value>
<a:CreationDate>1387787330</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1387787559</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o32">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>553610D3-C5A6-4A2D-84A1-8348506FCF77</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1526269494</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o33">
<a:ObjectID>23C63729-3F6C-42B7-9A76-0F094F0135D6</a:ObjectID>
<a:Name>IsKeepIdHistory</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o34">
<a:ObjectID>6290E327-134D-4899-88A9-7243C251B1C5</a:ObjectID>
<a:Name>IsChildOneToOne</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   %Get% = false
   dim i
   for i = 0 to obj.OutReferences.Count - 1
      if obj.OutReferences.Item(i).GetExtendedAttribute(&quot;IsOneToOne&quot;) = true then
         %Get% = true
         exit function
      end if
   next
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o35">
<a:ObjectID>C15635B6-8D9F-40C8-AF99-BA51C33FD70D</a:ObjectID>
<a:Name>IsParentOneToOne</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   %Get% = false
   dim i
   for i = 0 to obj.InReferences.Count - 1
      if obj.InReferences.Item(i).GetExtendedAttribute(&quot;IsOneToOne&quot;) = true then
         %Get% = true&#39;obj.InReferences.Item(i).Code
         exit function
      end if
   next
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o36">
<a:ObjectID>767725B9-D75C-431F-9BF5-0BE92341637F</a:ObjectID>
<a:Name>IsPeriodHistory</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o37">
<a:ObjectID>05FA00F3-B414-47EE-8E91-A92ED22F5B28</a:ObjectID>
<a:Name>HasCCode</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   dim i
   for i = 0 to obj.Columns.Count -1
      if lcase(obj.Columns.Item(i).Code) = &quot;ccode&quot; then
         %Get% = true
         exit function
      end if
   next
   %Get% = false
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o38">
<a:ObjectID>D5162532-2CAA-4397-AA55-6E371B293730</a:ObjectID>
<a:Name>HasRefParent</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   dim i
   for i = 0 to obj.Columns.Count -1
      if lcase(obj.Columns.Item(i).Code) = &quot;refparent&quot; then
         %Get% = true
         exit function
      end if
   next
   %Get% = false
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o39">
<a:ObjectID>44E07D25-8819-4AC2-A907-98A8F9E86E9E</a:ObjectID>
<a:Name>HasCode</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   dim i
   for i = 0 to obj.Columns.Count -1
      if lcase(obj.Columns.Item(i).Code) = &quot;code&quot; then
         %Get% = true
         exit function
      end if
   next
   %Get% = false
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o40">
<a:ObjectID>898BC4E7-AD6E-4BF3-8126-6CE776DDD143</a:ObjectID>
<a:Name>GenerateUniqueCode</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>true</a:ExtendedAttributeTargetItem.Value>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o41">
<a:ObjectID>DF9917E5-920B-4F07-A51A-EFB52994FE80</a:ObjectID>
<a:Name>CopyrightCompanyName</a:Name>
<a:CreationDate>1364447145</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364447672</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.Value>%Package.CopyrightCompanyName%</a:ExtendedAttributeTargetItem.Value>
<a:Template>1</a:Template>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o42">
<a:ObjectID>27C96E52-04D4-4DE1-B9EA-62FE763293B7</a:ObjectID>
<a:Name>UniqueColumnName</a:Name>
<a:CreationDate>1387787330</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1387787494</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%uniqueColumnNameList%</a:ExtendedAttributeTargetItem.ListOfValues>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o43">
<a:ObjectID>E2594A03-E1B6-4CE1-A482-F5F2CCD4CDC6</a:ObjectID>
<a:Name>HasWeight</a:Name>
<a:CreationDate>1466145519</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1466146003</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   dim i
   for i = 0 to obj.Columns.Count -1
      if lcase(obj.Columns.Item(i).Code) = &quot;weight&quot; then
         %Get% = true
         exit function
      end if
   next
   %Get% = false
End Function</a:GetMethodScript>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o44">
<a:ObjectID>05BC1A55-3219-4104-BAD8-5FB705872DFB</a:ObjectID>
<a:Name>UpdateTriggerPeriodHistorySQLEnd</a:Name>
<a:CreationDate>1486032582</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1486032887</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>14</a:ExtendedAttributeTargetItem.DataType>
<a:TextFormat>SQL</a:TextFormat>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o45">
<a:ObjectID>8326C38E-DA0A-48C5-A1E1-B1C8B0C4E8B3</a:ObjectID>
<a:Name>IsKeepIdHistoryOnlySelf</a:Name>
<a:CreationDate>1526269449</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1526270245</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o46">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>F3F7F718-5A7D-44D3-91B7-B884501241EA</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1335589071</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o47">
<a:ObjectID>E198DE5D-F028-438B-93C7-36D8AF70574A</a:ObjectID>
<a:Name>Scripts</a:Name>
<a:TemplateTargetItem.Value>%Scripts%</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o48">
<a:ObjectID>11DE2FF7-F2DC-4E5E-8D99-AC19B75F1E8E</a:ObjectID>
<a:Name>DropComputedColumns</a:Name>
<a:TemplateTargetItem.Value>%DropComputedColumns%</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o49">
<a:ObjectID>597CA5B4-7A3D-45A3-B621-3462A49BC7F9</a:ObjectID>
<a:Name>CheckForJoinData</a:Name>
<a:TemplateTargetItem.Value>%CheckForJoinData%</a:TemplateTargetItem.Value>
<a:CreationDate>1335589016</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1335589071</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o50">
<a:ObjectID>C01C0693-772F-4A54-9826-95D2BBC3E809</a:ObjectID>
<a:Name>JoinData</a:Name>
<a:TemplateTargetItem.Value>%JoinData%</a:TemplateTargetItem.Value>
<a:CreationDate>1335589016</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1363339301</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o51">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>E2D40240-93B7-4678-965A-DB61B78C75FA</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1433240513</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o52">
<a:ObjectID>E894D25A-9748-44A7-8126-B6A68BD02360</a:ObjectID>
<a:Name>SetTriggers</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1562038449</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim trigger, sql, triggerName, i
   set obj = GetShortcutObject(obj)
   if obj.GetExtendedAttribute(&quot;IsKeepIdHistory&quot;) or obj.GetExtendedAttribute(&quot;IsKeepIdHistoryOnlySelf&quot;) then
      if obj.GetExtendedAttribute(&quot;IsChildOneToOne&quot;) then
         if obj.GetExtendedAttribute(&quot;IsKeepIdHistory&quot;) then
            set trigger = nothing
            sql = obj.EvaluateTextFor(&quot;%InsertTrigger_HistoryOneToOne%&quot;, &quot;SqlScripts&quot;)
         
            triggerName = &quot;&quot; + obj.Code + &quot;_History_Insert&quot;
            for i = 0 to obj.Triggers.Count - 1
               if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
            next
            if trigger is nothing then
               set trigger = obj.Triggers.CreateNew
               trigger.Code = triggerName
               trigger.Name = triggerName
            end if
            trigger.Text = sql
         end if
         
         
         set trigger = nothing
         sql = obj.EvaluateTextFor(&quot;%UpdateTrigger_HistoryOneToOne%&quot;, &quot;SqlScripts&quot;)
         
         triggerName = &quot;&quot; + obj.Code + &quot;_History_Update&quot;
         for i = 0 to obj.Triggers.Count - 1
            if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
         next
         if trigger is nothing then
            set trigger = obj.Triggers.CreateNew
            trigger.Code = triggerName
            trigger.Name = triggerName
         end if
         trigger.Text = sql
      else
         set trigger = nothing
         sql = obj.EvaluateTextFor(&quot;%UpdateTriggerWith_keepIdHistory%&quot;, &quot;SqlScripts&quot;)
         
         triggerName = &quot;&quot; + obj.Code + &quot;_History&quot;
         for i = 0 to obj.Triggers.Count - 1
            if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
         next
         if trigger is nothing then
            set trigger = obj.Triggers.CreateNew
            trigger.Code = triggerName
            trigger.Name = triggerName
         end if
         trigger.Text = sql
         
         
         if obj.GetExtendedAttribute(&quot;IsKeepIdHistory&quot;) then
            set trigger = nothing
            sql = obj.EvaluateTextFor(&quot;%InsertTrigger_History%&quot;, &quot;SqlScripts&quot;)
         
            triggerName = &quot;&quot; + obj.Code + &quot;_History_Insert&quot;
            for i = 0 to obj.Triggers.Count - 1
               if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
            next
            if trigger is nothing then
               set trigger = obj.Triggers.CreateNew
               trigger.Code = triggerName
               trigger.Name = triggerName
            end if
            trigger.Text = sql
         end if
      end if
         
      set trigger = nothing
      sql = obj.EvaluateTextFor(&quot;%DeleteTriggerWith_isDel%&quot;, &quot;SqlScripts&quot;)
      
      triggerName = &quot;&quot; + obj.Code + &quot;_History_Delete&quot;
      for i = 0 to obj.Triggers.Count - 1
         if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
      next
      if trigger is nothing then
         set trigger = obj.Triggers.CreateNew
         trigger.Code = triggerName
         trigger.Name = triggerName
      end if
      trigger.Text = sql
   end if
   
   if obj.GetExtendedAttribute(&quot;IsPeriodHistory&quot;) then
      set trigger = nothing
      sql = obj.EvaluateTextFor(&quot;%UpdateTriggerPeriodHistory%&quot;, &quot;SqlScripts&quot;)
      
      triggerName = &quot;&quot; + obj.Code + &quot;_PeriodHistory&quot;
      for i = 0 to obj.Triggers.Count - 1
         if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
      next
      if trigger is nothing then
         set trigger = obj.Triggers.CreateNew
         trigger.Code = triggerName
         trigger.Name = triggerName
      end if
      trigger.Text = sql
      
      
      set trigger = nothing
      sql = obj.EvaluateTextFor(&quot;%DeleteTriggerPeriodHistory%&quot;, &quot;SqlScripts&quot;)
      
      triggerName = &quot;&quot; + obj.Code + &quot;_PeriodHistoryDel&quot;
      for i = 0 to obj.Triggers.Count - 1
         if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
      next
      if trigger is nothing then
         set trigger = obj.Triggers.CreateNew
         trigger.Code = triggerName
         trigger.Name = triggerName
      end if
      trigger.Text = sql
   end if
   
   sql = obj.EvaluateTextFor(&quot;%UniqueCode%&quot;, &quot;SqlScripts&quot;)
   if sql &lt;&gt; &quot;&quot; then   
      triggerName = &quot;&quot; + obj.Code + &quot;_UniqueCode&quot;
      set trigger = nothing
      for i = 0 to obj.Triggers.Count - 1
         if obj.Triggers.Item(i).Code = triggerName then set trigger = obj.Triggers.Item(i)
      next
      if trigger is nothing then
         set trigger = obj.Triggers.CreateNew
         trigger.Code = triggerName
         trigger.Name = triggerName
      end if
      trigger.Text = sql
   end if
End Sub</a:MethodScript>
</o:MethodTargetItem>
<o:MethodTargetItem Id="o53">
<a:ObjectID>FE55C1DC-BC7B-46B3-B621-6E240ABD9311</a:ObjectID>
<a:Name>CreateAutoIndex</a:Name>
<a:CreationDate>1433239995</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1433241792</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim i, column, reference, iindex, index, indexName, indexColumn
   dim dateStartColumn, dateEndColumn
   
   set dateStartColumn = nothing
   set dateEndColumn = nothing
   if obj.GetExtendedAttribute(&quot;IsPeriodHistory&quot;) then
      for i = 0 to obj.Columns.Count - 1
         set column = obj.Columns.Item(i)
         if lcase(column.Code) = &quot;datestart&quot; then set dateStartColumn = column
         if lcase(column.Code) = &quot;dateend&quot; then set dateEndColumn = column
      next
   end if
      
   for i = 0 to obj.Columns.Count - 1
      set column = obj.Columns.Item(i)
      if column.ForeignKey or lcase(column.Code) = &quot;code&quot; or lcase(column.Code) = &quot;ccode&quot; then
         indexName = &quot;AutoIndex_&quot; &amp; obj.Code &amp; &quot;_&quot; &amp; column.Code
         set index = nothing
         for iindex = 0 to obj.Indexes.Count - 1
            if obj.Indexes.Item(iindex).Code = indexName then 
               set index = obj.Indexes.Item(iindex)
               exit for
            end if
         next
         
         if index is nothing then
            set index = obj.Indexes.CreateNew()
            index.Code = indexName
            index.Name = indexName
            
            set indexColumn = index.IndexColumns.CreateNew()
            set indexColumn.Column = column

            if not dateStartColumn is nothing then
               set indexColumn = index.IndexColumns.CreateNew()
               set indexColumn.Column = dateStartColumn
            end if
            if not dateEndColumn is nothing then
               set indexColumn = index.IndexColumns.CreateNew()
               set indexColumn.Column = dateEndColumn
            end if
         end if
      end if
   next
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o54">
<a:TypePublicName>MenuTargetItem</a:TypePublicName>
<a:ObjectID>A2E1B2B4-F0D0-4729-B055-DB3781D118F7</a:ObjectID>
<a:Name>Menus</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MenuTargetItem Id="o55">
<a:ObjectID>6162C74E-1048-4E07-BB85-C3E97C578573</a:ObjectID>
<a:Name>Menu_1</a:Name>
<a:MenuTargetItem.Value>&lt;Menu&gt;
   &lt;Command Name=&quot;SetTriggers&quot; Caption=&quot;Set history triggers&quot; /&gt;
   &lt;Command Name=&quot;CreateAutoIndex&quot; Caption=&quot;CreateAutoIndex&quot; /&gt;
&lt;/Menu&gt;
</a:MenuTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1433240598</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:MenuTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o56">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>2F95B430-2553-42D8-9712-D9F6CD42D741</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1391148884</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1391148930</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o57">
<a:ObjectID>026C7D86-3140-4025-9CE6-CBE756C593B9</a:ObjectID>
<a:Name>SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;CopyrightCompanyName&quot; AttributeID=&quot;{DF9917E5-920B-4F07-A51A-EFB52994FE80}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;HorizontalLayout Name=&quot;HorizontalLayout3&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;GenerateUniqueCode&quot; AttributeID=&quot;{898BC4E7-AD6E-4BF3-8126-6CE776DDD143}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HasCCode&quot; AttributeID=&quot;{05FA00F3-B414-47EE-8E91-A92ED22F5B28}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HasCode&quot; AttributeID=&quot;{44E07D25-8819-4AC2-A907-98A8F9E86E9E}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;false&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HasRefParent&quot; AttributeID=&quot;{D5162532-2CAA-4397-AA55-6E371B293730}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;false&quot; /&gt;
   &lt;/HorizontalLayout&gt;
   &lt;HorizontalLayout Name=&quot;HorizontalLayout1&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsInTable&quot; AttributeID=&quot;{401BAAE7-B1BF-4F0F-BC6D-47D3E1AE8185}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsForAddAndDelete&quot; Caption=&quot;Add&amp;amp;Delete&quot; AttributeID=&quot;{86CF0F86-FC53-47A7-96E3-BD38B82801E0}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsForAdd&quot; Caption=&quot;Add&quot; AttributeID=&quot;{AC67AF6F-7ABD-4F35-A007-4E5AECC69F77}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableTitle&quot; Caption=&quot;Title&quot; AttributeID=&quot;{040A5FB0-7DCE-4483-872D-A2959B8D8EFE}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableCode&quot; Caption=&quot;Code&quot; AttributeID=&quot;{086E1A56-97D0-42C3-AB62-E5DDE9D52791}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;/HorizontalLayout&gt;
   &lt;HorizontalLayout Name=&quot;HorizontalLayout2&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableAdditionalCode&quot; AttributeID=&quot;{90966B59-969A-44AC-A8E7-8C729154AC04}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableAdditionalTitle&quot; AttributeID=&quot;{AD45B81A-7936-43F7-8D4B-B626818ACB58}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;/HorizontalLayout&gt;
   &lt;HorizontalLayout Name=&quot;HorizontalLayout4&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;IsChildOneToOne&quot; AttributeID=&quot;{6290E327-134D-4899-88A9-7243C251B1C5}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;IsKeepIdHistory&quot; AttributeID=&quot;{23C63729-3F6C-42B7-9A76-0F094F0135D6}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;IsKeepIdHistoryOnlySelf&quot; AttributeID=&quot;{8326C38E-DA0A-48C5-A1E1-B1C8B0C4E8B3}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;IsParentOneToOne&quot; AttributeID=&quot;{C15635B6-8D9F-40C8-AF99-BA51C33FD70D}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;false&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;IsPeriodHistory&quot; AttributeID=&quot;{767725B9-D75C-431F-9BF5-0BE92341637F}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;false&quot; /&gt;
   &lt;/HorizontalLayout&gt;
   &lt;ExtendedAttribute Attribute=&quot;UniqueColumnName&quot; AttributeID=&quot;{27C96E52-04D4-4DE1-B9EA-62FE763293B7}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;TabWindow Name=&quot;TabWindow1&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;UpdateTriggerPeriodHistorySQLEnd&quot; AttributeID=&quot;{05BC1A55-3219-4104-BAD8-5FB705872DFB}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;Yes&quot; LeftText=&quot;false&quot; /&gt;
   &lt;/TabWindow&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1391148884</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1526270245</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o58">
<a:ObjectID>8806687A-5B78-4D27-ACB8-6B483B1A61A8</a:ObjectID>
<a:Name>Reference</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o59">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>57C9FA2F-087B-4486-B3C5-8A83D18F2748</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1363339139</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o60">
<a:ObjectID>98E95376-E3F7-4294-983C-40E04485672E</a:ObjectID>
<a:Name>IsOneToOne</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   if obj.Joins.Count &gt; 0 then
      if not obj.Joins.Item().ChildTableColumn is nothing then
         %Get% = obj.Joins.Item().ChildTableColumn.Primary
      end if
   end if
End Function</a:GetMethodScript>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o61">
<a:ObjectID>F22FECC9-EB22-4ACC-8B53-23D9BAA0092B</a:ObjectID>
<a:Name>JoinDataByReference</a:Name>
<a:CreationDate>1363328579</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1363328639</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>true</a:ExtendedAttributeTargetItem.Value>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o62">
<a:ObjectID>955CD450-5AE2-417B-B6BA-61E885EECAC7</a:ObjectID>
<a:Name>CustomJoinData</a:Name>
<a:CreationDate>1363339043</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1363339139</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>14</a:ExtendedAttributeTargetItem.DataType>
<a:TextFormat>SQL</a:TextFormat>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o63">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>D9D58039-C0B9-4D03-9C1D-90CA5DD3DEF1</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1335589162</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1345006643</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o64">
<a:ObjectID>FD9D2953-BC1A-4D5A-B968-5290D10B9F89</a:ObjectID>
<a:Name>GetChildColumn</a:Name>
<a:TemplateTargetItem.Value>.if(%Joins.Count% == 1)
%Joins.First.ChildTableColumn%
.else
Error to get ChildColumn for %Code%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1335589162</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1335589316</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o65">
<a:ObjectID>B8D6CC57-90FF-4FC6-A3FC-6B5B09D265B5</a:ObjectID>
<a:Name>GetChildTable</a:Name>
<a:TemplateTargetItem.Value>%ChildTable%</a:TemplateTargetItem.Value>
<a:CreationDate>1345006589</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1345006643</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o66">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>D5D8F7E5-18D3-481A-B301-C276BB6B25C9</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o67">
<a:ObjectID>0275DE3D-F42F-401A-B481-F0313EC3BF2D</a:ObjectID>
<a:Name>JazzSoft SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;IsOneToOne&quot; AttributeID=&quot;{98E95376-E3F7-4294-983C-40E04485672E}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;JoinDataByReference&quot; AttributeID=&quot;{F22FECC9-EB22-4ACC-8B53-23D9BAA0092B}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;TabWindow Name=&quot;TabWindow1&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;CustomJoinData&quot; AttributeID=&quot;{955CD450-5AE2-417B-B6BA-61E885EECAC7}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;Yes&quot; /&gt;
   &lt;/TabWindow&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o68">
<a:ObjectID>9970B66C-DA96-4D44-A13D-C2DDF000AD5F</a:ObjectID>
<a:Name>Model</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o69">
<a:TypePublicName>MenuTargetItem</a:TypePublicName>
<a:ObjectID>2E80E8F6-B03C-4F22-AF03-3B6430FFA683</a:ObjectID>
<a:Name>Menus</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MenuTargetItem Id="o70">
<a:ObjectID>C3BF2F09-7E2D-4FE4-8A98-BB419375B7F1</a:ObjectID>
<a:Name>Generate</a:Name>
<a:MenuTargetItem.Value>&lt;Menu&gt;
   &lt;Command Name=&quot;Generate&quot; Caption=&quot;Сгенерировать скрипт для историчных таблиц&quot; /&gt;
&lt;/Menu&gt;
</a:MenuTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MenuTargetItem.Location>FileExport</a:MenuTargetItem.Location>
</o:MenuTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o71">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>B10CF1B7-1561-4081-ABF2-9C222D17B6EB</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o72">
<a:ObjectID>E643CFCE-3E11-4BC5-B8D3-200B3C4E25AC</a:ObjectID>
<a:Name>Generate</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim shell, folder
   set shell = CreateObject(&quot;Shell.Application&quot;)
   set folder = shell.BrowseForFolder(MainWindowHandle, &quot;Укажите каталог для сохранения сгенерированных файлов&quot;, 16)
   if(Not (folder is Nothing)) then
      Output &quot;Генерация в каталог &#39;&quot; + folder.Items().Item().Path + &quot;&#39;:&quot;      
      ActiveModel.GetPackageOptions().GenerationPath = folder.Items().Item().Path + &quot;\&quot;
      obj.GenerateFiles folder.Items().Item().Path, nothing, &quot;SqlScripts&quot;
      Output &quot;Генерация закончена&quot;
   end if
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o73">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>ABD7E0C1-8141-4A23-AA8A-2F668792A1B5</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o74">
<a:ObjectID>B3CA2D18-B326-4EC6-96EC-0D741ADDA7EB</a:ObjectID>
<a:Name>Scripts</a:Name>
<a:TemplateTargetItem.Value>%Scripts%</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Filename>Scripts.sql</a:Filename>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o75">
<a:ObjectID>325B3A57-59C3-4272-91B1-82A1572DC5DA</a:ObjectID>
<a:Name>DropComputedColumns</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Tables)
%DropComputedColumns%
.next(\n\n)</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Filename>DropComputedColumns.sql</a:Filename>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o76">
<a:ObjectID>D54CA2EE-11D0-4431-9CE7-CA50C7D58AB1</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>%TableNames%</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Filename>TableNames.sql</a:Filename>
<a:GeneratedFileTargetItem.Encoding>UTF8Marked</a:GeneratedFileTargetItem.Encoding>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o77">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>E65DB860-D101-497F-B335-4FE41A7DA2C9</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o78">
<a:ObjectID>079D0333-1FE6-487A-8094-CEB9840E0BBC</a:ObjectID>
<a:Name>Scripts</a:Name>
<a:TemplateTargetItem.Value>set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
GO

.foreach_item(Tables,\n,\n)
   .ifnot(%IsShortcut%)
%Scripts%
   .endif
.next(\n\n)
.foreach_item(Packages,\n,\n)
   .ifnot(%IsShortcut%)
%Scripts%
   .endif
.next(\n\n)</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o79">
<a:ObjectID>7E5DDBAD-6375-4418-B631-609EFD4987CC</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Tables,,\n)
%TableNames%
UNION
.next(\n)
.foreach_item(Views,,\n)
%TableNames%
UNION
.next(\n)
.foreach_item(ExtendedObjects,,\n)
   .if (%Stereotype% == &quot;Journal&quot;)
%TableNames%
UNION
   .endif
.next(\n)
.foreach_item(Packages,,\n)
%TableNames%
UNION
.next(\n)</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350617474</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o80">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>C5307AB6-71D1-44FC-9611-8B5371B06E5B</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1507281671</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o81">
<a:ObjectID>514EEAD9-A55E-4BBC-B786-3289FD347C02</a:ObjectID>
<a:Name>CopyrightCompanyName</a:Name>
<a:CreationDate>1507281671</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o82">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>D714C897-E8AD-496A-9A87-8FB4A247BD9B</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1507281671</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o83">
<a:ObjectID>C7922E25-3864-43DE-BAA9-15CB4B9F1CA9</a:ObjectID>
<a:Name>SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;CopyrightCompanyName&quot; AttributeID=&quot;{514EEAD9-A55E-4BBC-B786-3289FD347C02}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1507281671</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1507281734</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o84">
<a:ObjectID>9EAD7FC9-5D0D-4D1C-9F7D-35D05EA2881D</a:ObjectID>
<a:Name>BaseTable</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1397728169</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o85">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>3D39E89A-52BC-4398-8D61-C80DD736D26E</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1433240513</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o86">
<a:ObjectID>EDBB94AE-103D-4E7F-9E04-18405E203F47</a:ObjectID>
<a:Name>COMPOUNDCODE_Table</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim trigger, i

   set trigger = nothing
   for i = 0 to obj.Triggers.Count - 1
      if obj.Triggers.Item(i).Code = &quot;COMPOUNDCODE_&quot; + obj.Code then set trigger = obj.Triggers.Item(i)
   next
   if trigger is nothing then
      set trigger = obj.Triggers.CreateNew
      trigger.Code = &quot;COMPOUNDCODE_&quot; + obj.Code
      trigger.Name = trigger.Code
   end if
   trigger.Text = trigger.EvaluateTextFor(&quot;%COMPOUNDCODE_Table%&quot;, &quot;SqlScripts&quot;)
End Sub</a:MethodScript>
</o:MethodTargetItem>
<o:MethodTargetItem Id="o87">
<a:ObjectID>0DA80101-F979-4B95-8EF0-FA549A6A859F</a:ObjectID>
<a:Name>AddUpdateTrigger_HistoryOfFieldsChanges</a:Name>
<a:CreationDate>1397705217</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397705590</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim triggerName, trigger, i

   triggerName = obj.EvaluateTemplateFor(&quot;Trigger_HistoryOfFieldsInTable_Name&quot;, &quot;SqlScripts&quot;)
   set trigger = nothing
   for i = 0 to obj.Triggers.Count - 1
      if obj.Triggers.Item(i).Code = triggerName then 
         set trigger = obj.Triggers.Item(i)
         exit for
      end if   
   next

   if trigger is nothing then
      set trigger = obj.Triggers.CreateNew
      trigger.Code = triggerName
      trigger.Name = triggerName
      trigger.Comment = &quot;Сохраняем историю изменения таблицы&quot;
   end if
   
   trigger.Text = obj.EvaluateTemplateFor(&quot;Trigger_HistoryOfFieldsInTable&quot;, &quot;SqlScripts&quot;)
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o88">
<a:TypePublicName>MenuTargetItem</a:TypePublicName>
<a:ObjectID>EE1908F7-6E56-4B00-963D-AC43EC7AA21A</a:ObjectID>
<a:Name>Menus</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1369221028</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MenuTargetItem Id="o89">
<a:ObjectID>8F9ABBEB-433F-4DB0-92BB-46AF90FBC046</a:ObjectID>
<a:Name>COMPOUNDCODE_Table</a:Name>
<a:MenuTargetItem.Value>&lt;Menu&gt;
   &lt;Command Name=&quot;COMPOUNDCODE_Table&quot; Caption=&quot;Триггер на обновление поля ccode в дереве&quot; /&gt;
   &lt;Command Name=&quot;AddUpdateTrigger_HistoryOfFieldsChanges&quot; Caption=&quot;AddUpdateTrigger_HistoryOfFieldsChanges&quot; /&gt;
&lt;/Menu&gt;
</a:MenuTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1397705439</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:MenuTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o90">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>34187AC1-7278-4303-B11C-0FE70AF12B4F</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1472445468</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o91">
<a:ObjectID>401BAAE7-B1BF-4F0F-BC6D-47D3E1AE8185</a:ObjectID>
<a:Name>HistoryOfFieldsInTable</a:Name>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209032</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:DestinationClassID>380BAA40-0042-11D2-BD28-00A02478ECC9</a:DestinationClassID>
<a:ValidateDataType>0</a:ValidateDataType>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o92"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o93">
<a:ObjectID>86CF0F86-FC53-47A7-96E3-BD38B82801E0</a:ObjectID>
<a:Name>HistoryOfFieldsForAddAndDelete</a:Name>
<a:CreationDate>1397635044</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397635149</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o94">
<a:ObjectID>040A5FB0-7DCE-4483-872D-A2959B8D8EFE</a:ObjectID>
<a:Name>HistoryOfFieldsTableTitle</a:Name>
<a:CreationDate>1397635163</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397635341</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o95">
<a:ObjectID>086E1A56-97D0-42C3-AB62-E5DDE9D52791</a:ObjectID>
<a:Name>HistoryOfFieldsTableCode</a:Name>
<a:CreationDate>1397635455</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397635504</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o96">
<a:ObjectID>5DE05E65-735E-449F-82B3-A0FA23EBECFC</a:ObjectID>
<a:Name>HistoryOfFieldsInTableFilled</a:Name>
<a:CreationDate>1397639158</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639247</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   dim table
   set table = obj.GetExtendedAttribute(&quot;HistoryOfFieldsInTable&quot;)
   if table is nothing then
      %Get% = false
   else
      %Get% = true
   end if
End Function</a:GetMethodScript>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o97">
<a:ObjectID>90966B59-969A-44AC-A8E7-8C729154AC04</a:ObjectID>
<a:Name>HistoryOfFieldsTableAdditionalCode</a:Name>
<a:CreationDate>1397711259</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397712146</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o98">
<a:ObjectID>AD45B81A-7936-43F7-8D4B-B626818ACB58</a:ObjectID>
<a:Name>HistoryOfFieldsTableAdditionalTitle</a:Name>
<a:CreationDate>1397711259</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397712146</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o99">
<a:ObjectID>AC67AF6F-7ABD-4F35-A007-4E5AECC69F77</a:ObjectID>
<a:Name>HistoryOfFieldsForAdd</a:Name>
<a:CreationDate>1472445418</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1472445468</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>%HistoryOfFieldsForAddAndDelete%</a:ExtendedAttributeTargetItem.Value>
<a:Template>1</a:Template>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o100">
<a:TypePublicName>ExtendedCollectionTargetItem</a:TypePublicName>
<a:ObjectID>42566016-68CA-494E-B4D8-3734EC616BAB</a:ObjectID>
<a:Name>Extended Collections</a:Name>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209032</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedCollectionTargetItem Id="o92">
<a:ObjectID>F1C82FCC-E8BF-4523-AF1C-2F08737A1B0D</a:ObjectID>
<a:Name>HistoryOfFieldsInTable</a:Name>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209032</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>380BAA40-0042-11D2-BD28-00A02478ECC9</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o101">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>5D7250D7-997F-424B-916C-A08AF39275CF</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397705217</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o102">
<a:ObjectID>AFEDD283-FBB6-4D03-B1C0-81C0B15AFF76</a:ObjectID>
<a:Name>Trigger_HistoryOfFieldsInTable</a:Name>
<a:TemplateTargetItem.Value>SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		%CurrentUser%
-- Create date: %CurrentDate%
-- Description:	Сохраняем историю изменения таблицы
-- =============================================
CREATE TRIGGER dbo.%Trigger_HistoryOfFieldsInTable_Name%
   ON  dbo.%Code% 
   AFTER UPDATE
.if (%HistoryOfFieldsForAdd%)
, INSERT
.endif
.if (%HistoryOfFieldsForAddAndDelete%)
, DELETE
.endif

AS 
BEGIN
	SET NOCOUNT ON;


.foreach_item(Columns)
   .if(%WriteToHistory%)
   insert into %Parent.HistoryOfFieldsInTable.Code% (ValueOld, ValueNew, DateChange, FieldName, FieldDescription
      .foreach_item(Parent.Columns,&quot;, &quot;)
         .if (%WriteToColumn%)
%WriteToColumn.Code%
            .if(%ForeignKey%)
               .if (%WriteToColumnByForeignKey%)
, %WriteToColumnByForeignKey.Code%
               .endif
               .if (%WriteToColumnByForeignKey2%)
, %WriteToColumnByForeignKey2.Code%
               .endif
            .endif               
         .elsif (%WriteToHistory% == false) and (%ForeignKey%)
            .if (%WriteToColumnByForeignKey%)
%WriteToColumnByForeignKey.Code%
            .endif
            .if (%WriteToColumnByForeignKey2%)
[%WriteToColumnByForeignKey%?, ]%WriteToColumnByForeignKey2.Code%
            .endif
         .endif
      .next(&quot;, &quot;)
)
   select %Trigger_HistoryOfFieldsInTable_FieldCodeValue(d)%
      , %Trigger_HistoryOfFieldsInTable_FieldCodeValue(i)%
      , GetDate()
      , N&#39;%FieldCode%&#39;
      , N&#39;%FieldName%&#39;
      .foreach_item(Parent.Columns,&quot;\n      , &quot;)
         .if (%WriteToColumn%)
%WriteToColumnValue%
            .if(%ForeignKey%)
               .if (%WriteToColumnByForeignKey%)
\n      , %WriteToColumnByForeignKeyValue%
               .endif
               .if (%WriteToColumnByForeignKey2%)
\n      , %WriteToColumnByForeignKeyValue2%
               .endif
            .endif               
         .elsif (%WriteToHistory% == false) and (%ForeignKey%)
            .if (%WriteToColumnByForeignKey%)
%WriteToColumnByForeignKeyValue%
            .endif
            .if (%WriteToColumnByForeignKey2%)
[%WriteToColumnByForeignKey%?\n      , ]%WriteToColumnByForeignKeyValue2%
            .endif
         .endif
      .next(&quot;\n      , &quot;)

	from INSERTED i
		
      .if (%Parent.HistoryOfFieldsForAddAndDelete%)
full 
      .elsif (%Parent.HistoryOfFieldsForAdd%)
left 
      .endif
join DELETED d on d.id = i.id

      .if (%ForeignKey%)
		left join %GetParentTable.Code% iv on iv.%GetParentTableColumn.Code% = i.%Code%
		left join %GetParentTable.Code% dv on dv.%GetParentTableColumn.Code% = d.%Code%

      .endif
      .foreach_item(Parent.Columns,,\n)
         .if (%ForeignKey%) and ((%WriteToHistory% == false) or (%WriteToColumn%))
            .if (%WriteToColumnByForeignKey%) or (%WriteToColumnByForeignKey2%)
		left join %GetParentTable.Code% i%Code% on i%Code%.%GetParentTableColumn.Code% = i.%Code%
		left join %GetParentTable.Code% d%Code% on d%Code%.%GetParentTableColumn.Code% = d.%Code%
            .endif
            .if (%WriteToColumnByForeignKey2%) and (%WriteColumnOfParentTable.ForeignKey%)

		left join %WriteColumnOfParentTable.GetParentTable.Code% i%Code%2 on i%Code%2.%WriteColumnOfParentTable.GetParentTableColumn.Code% = i%Code%.%WriteColumnOfParentTable.Code%
		left join %WriteColumnOfParentTable.GetParentTable.Code% d%Code%2 on d%Code%2.%WriteColumnOfParentTable.GetParentTableColumn.Code% = d%Code%.%WriteColumnOfParentTable.Code%
            .elsif (%WriteToColumnByForeignKey2%)

		left join %GetParentTable.Code% i%Code%2 on i%Code%2.%GetParentTableColumn.Code% = i.%Code%
		left join %GetParentTable.Code% d%Code%2 on d%Code%2.%GetParentTableColumn.Code% = d.%Code%
            .endif
         .endif
      .next(&quot;\n&quot;)
	where (d.\[%Code%] &lt;&gt; i.\[%Code%]
      .if(%Mandatory% == false) or (%Parent.HistoryOfFieldsForAddAndDelete%) or (%Parent.HistoryOfFieldsForAdd%)
 or (d.\[%Code%] is null and i.\[%Code%] is not null) or (d.\[%Code%] is not null and i.\[%Code%] is null)
      .endif
)
      .if (%Parent.HistoryOfFieldsForAddAndDelete% == false)
         .foreach_item(Parent.Columns,&quot; and &quot;)
            .if(%WriteToColumn%) and (%WriteToColumn.Mandatory%) and (%Mandatory% == false)
i.%Code% is not null
            .endif
         .next(&quot; and &quot;)
      .endif
   .endif
.next(\n\n)

END
GO
</a:TemplateTargetItem.Value>
<a:CreationDate>1317208948</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478773092</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o103">
<a:ObjectID>FDB06EC5-5103-4CCE-9AE9-FA17A043449C</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>SELECT N&#39;%Code%&#39; as Code, N&#39;%Name%&#39; as Name, N&#39;%SQLComment%&#39; as Comment, &#39;%Package.Code%&#39; as PackageCode, &#39;%Package.Name%&#39; as PackageName, &#39;%Package.SQLComment%&#39; as PackageComment</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350564600</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o104">
<a:ObjectID>D8921DBD-A286-47AD-859F-252324BCB41E</a:ObjectID>
<a:Name>Trigger_HistoryOfFieldsInTable_Name</a:Name>
<a:TemplateTargetItem.Value>Tri_U_%Code%_SaveChanges</a:TemplateTargetItem.Value>
<a:CreationDate>1397705167</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397705217</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o105">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>A878275D-3D4F-49D7-ADC7-97629BCB9195</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1317210299</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317210323</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o106">
<a:ObjectID>551EFCF6-20D1-4A65-8275-6F4CF1F8D5EB</a:ObjectID>
<a:Name>SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsInTable&quot; AttributeID=&quot;{401BAAE7-B1BF-4F0F-BC6D-47D3E1AE8185}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsForAddAndDelete&quot; AttributeID=&quot;{86CF0F86-FC53-47A7-96E3-BD38B82801E0}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsForAdd&quot; AttributeID=&quot;{AC67AF6F-7ABD-4F35-A007-4E5AECC69F77}&quot; GrayHiddenAttributes=&quot;Yes&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableTitle&quot; AttributeID=&quot;{040A5FB0-7DCE-4483-872D-A2959B8D8EFE}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableCode&quot; AttributeID=&quot;{086E1A56-97D0-42C3-AB62-E5DDE9D52791}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableAdditionalCode&quot; AttributeID=&quot;{90966B59-969A-44AC-A8E7-8C729154AC04}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;HistoryOfFieldsTableAdditionalTitle&quot; AttributeID=&quot;{AD45B81A-7936-43F7-8D4B-B626818ACB58}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1317210299</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1472445652</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o107">
<a:TypePublicName>CriterionTargetItem</a:TypePublicName>
<a:ObjectID>112E6559-5CB0-41F7-880D-CDDFC2710100</a:ObjectID>
<a:Name>Criteria</a:Name>
<a:CreationDate>1397728135</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397728169</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:CriterionTargetItem Id="o108">
<a:ObjectID>371D2492-122A-4AD3-B61E-03A6B72A188D</a:ObjectID>
<a:Name>HistoryOfFieldsInTableFilled</a:Name>
<a:CriterionTargetItem.Value>(%HistoryOfFieldsInTableFilled%)</a:CriterionTargetItem.Value>
<a:CreationDate>1397728135</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397728169</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o109">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>2CCEC7E5-BCEC-492A-8302-A7DEE8BCEDA1</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>1397728135</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397728169</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o110">
<a:ObjectID>C50511A7-8917-483D-B577-CA37F78DE7FA</a:ObjectID>
<a:Name>Trigger_HistoryOfFieldsInTable</a:Name>
<a:TemplateTargetItem.Value>%Trigger_HistoryOfFieldsInTable%</a:TemplateTargetItem.Value>
<a:CreationDate>1317210421</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397728169</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:CriterionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o111">
<a:ObjectID>39D25430-F531-4349-9659-349D98FDDC56</a:ObjectID>
<a:Name>Trigger</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o112">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>FF377227-8BC1-4FFD-BC50-0E68DF5077BC</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o113">
<a:ObjectID>02F21376-18D1-4B0C-A889-933A1CF9939D</a:ObjectID>
<a:Name>COMPOUNDCODE_Table</a:Name>
<a:TemplateTargetItem.Value>set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

CREATE TRIGGER [%Code%]
   ON [dbo].[%Table.Code%]
   FOR INSERT, UPDATE
AS
BEGIN
   SET NOCOUNT ON;
   if not Exists(select * from INSERTED)
      return

   IF UPDATE(code) OR UPDATE(refParent)
   BEGIN
      UPDATE %Table.Code%
      SET ccode = isnull(t.ccode, &#39;&#39;) + i.code
      FROM INSERTED i
          left join
          (
              select *
              from %Table.Code%
          ) t on t.id = i.refParent
      WHERE %Table.Code%.id = i.id

      UPDATE %Table.Code%
      SET code = t.code
      FROM INSERTED i
         join %Table.Code% t on t.refParent = i.id
   END
END
go</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o114">
<a:ObjectID>425A15A0-EB83-4276-9368-EDDE05BF1890</a:ObjectID>
<a:Name>Package</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o115">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>32CC6DCB-7CA8-4B8C-9BD3-2723ABD247CE</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o116">
<a:ObjectID>513BFF32-7D9B-4D43-861F-857E996D16DF</a:ObjectID>
<a:Name>Scripts</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Tables,\n,\n)
   .ifnot(%IsShortcut%)
%Scripts%
   .endif
.next(\n\n)
.foreach_item(Packages,\n,\n)
   .ifnot(%IsShortcut%)
%Scripts%
   .endif
.next(\n\n)</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>0</a:ModificationDate>
<a:Modifier/>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o117">
<a:ObjectID>596C5719-091F-419E-9E36-CE1ADF1D59F9</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Tables,,\n)
%TableNames%
UNION
.next(\n)
.foreach_item(Views,,\n)
%TableNames%
UNION
.next(\n)
.foreach_item(ExtendedObjects,,\n)
   .if (%Stereotype% == &quot;Journal&quot;)
%TableNames%
UNION
   .endif
.next(\n)
.foreach_item(Packages,,\n)
%TableNames%
UNION
.next(\n)</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350617474</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o118">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>23847C82-6AED-43F6-9BB8-037488FC0E91</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1350564232</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o119">
<a:ObjectID>A7F4A414-A137-4038-8A46-DF851ABDCCFC</a:ObjectID>
<a:Name>SQLScripts</a:Name>
<a:TemplateTargetItem.Value>%Scripts%</a:TemplateTargetItem.Value>
<a:CreationDate>0</a:CreationDate>
<a:Creator/>
<a:ModificationDate>1445935049</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:UsePackagePath>0</a:UsePackagePath>
</o:GeneratedFileTargetItem>
<o:GeneratedFileTargetItem Id="o120">
<a:ObjectID>4393264F-18B6-42E5-BF4D-29198BC67FDA</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>%TableNames%</a:TemplateTargetItem.Value>
<a:CreationDate>1350563799</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1445935049</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:UsePackagePath>0</a:UsePackagePath>
<a:Filename>%Code%\TableNames.sql</a:Filename>
<a:GeneratedFileTargetItem.Encoding>UTF8Marked</a:GeneratedFileTargetItem.Encoding>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o121">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>6D40A187-A907-400C-B93A-31561496081E</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>1351771517</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351772974</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o122">
<a:ObjectID>E6F7C519-5931-4A6F-9E67-BDA94DCCE4E9</a:ObjectID>
<a:Name>SetTriggersForAllTables</a:Name>
<a:CreationDate>1351771517</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351772992</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim i, table
   for i = 0 to obj.Tables.Count - 1
      set table = obj.Tables.Item(i)
      if not table.IsShortcut() then
         table.ExecuteCustomMethod(&quot;SqlScripts.SetTriggers&quot;)
      end if
   next
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o123">
<a:TypePublicName>MenuTargetItem</a:TypePublicName>
<a:ObjectID>AD11ED01-E272-4D46-8E39-C4704FF35BEE</a:ObjectID>
<a:Name>Menus</a:Name>
<a:CreationDate>1351771517</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351772974</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MenuTargetItem Id="o124">
<a:ObjectID>D159837A-507C-4F5B-9701-AE8E50913B26</a:ObjectID>
<a:Name>Set history triggers for all tables</a:Name>
<a:MenuTargetItem.Value>&lt;Menu&gt;
   &lt;Command Name=&quot;SetTriggersForAllTables&quot; Caption=&quot;SetTriggersForAllTables&quot; /&gt;
&lt;/Menu&gt;
</a:MenuTargetItem.Value>
<a:CreationDate>1351771517</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351772974</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:MenuTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o125">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>4D87ED3A-EC81-4E10-B984-96188055D101</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o126">
<a:ObjectID>99D4E6E8-5D48-43C2-9A8E-2D9009019037</a:ObjectID>
<a:Name>CopyrightCompanyName</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.Value>JazzSoft</a:ExtendedAttributeTargetItem.Value>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o127">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>92463AFD-DE29-4420-AB7C-5C9A4A734263</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o128">
<a:ObjectID>EA966090-7115-4DFA-BB71-4F59CF3E4556</a:ObjectID>
<a:Name>JazzSoft SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;CopyrightCompanyName&quot; AttributeID=&quot;{99D4E6E8-5D48-43C2-9A8E-2D9009019037}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; HorizontalResize=&quot;Yes&quot; /&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o129">
<a:ObjectID>98FB0A7E-0720-4EC6-9D30-DD373E35B31E</a:ObjectID>
<a:Name>BaseColumn</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397707334</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o130">
<a:TypePublicName>CriterionTargetItem</a:TypePublicName>
<a:ObjectID>58C7FA41-89DA-47C7-B309-4176EE9BAFE2</a:ObjectID>
<a:Name>Criteria</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209490</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:CriterionTargetItem Id="o131">
<a:ObjectID>57B6AFBC-7C08-4612-BF22-665414EADBBD</a:ObjectID>
<a:Name>HistoryOfFieldsInTable</a:Name>
<a:CriterionTargetItem.Value>(%Parent.HistoryOfFieldsInTableFilled%)</a:CriterionTargetItem.Value>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397709956</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o132">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>31BD569A-EEA2-4395-A731-B369C289545A</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397709528</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o133">
<a:ObjectID>3933A3C3-C954-4EB1-8669-5F7EF0AA87C3</a:ObjectID>
<a:Name>WriteToHistory</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317210193</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>%defaultWriteToHistory%</a:ExtendedAttributeTargetItem.Value>
<a:Template>1</a:Template>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o134">
<a:ObjectID>E5706A89-02ED-4CE7-9587-59A5175D6B9C</a:ObjectID>
<a:Name>WriteToColumn</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209490</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%writeToColumnList%</a:ExtendedAttributeTargetItem.ListOfValues>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:ExtendedAttributeTargetItem.Complete>1</a:ExtendedAttributeTargetItem.Complete>
<a:ValidateDataType>0</a:ValidateDataType>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o135"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o136">
<a:TypePublicName>ExtendedCollectionTargetItem</a:TypePublicName>
<a:ObjectID>0AA2CDDA-895F-41CC-91DA-70FB722ABB37</a:ObjectID>
<a:Name>Extended Collections</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317211387</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedCollectionTargetItem Id="o135">
<a:ObjectID>19837309-53CF-496C-A045-B16C77EA7ADD</a:ObjectID>
<a:Name>WriteToColumn</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317209490</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80 DTTP 60</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
<o:ExtendedCollectionTargetItem Id="o137">
<a:ObjectID>87242FDA-16C5-4FAE-B6ED-99A9E6C94065</a:ObjectID>
<a:Name>WriteColumnOfParentTable</a:Name>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317211556</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80 DTTP 60</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o138">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>539D3409-F6A2-409B-8797-7476954BE135</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397710420</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o139">
<a:ObjectID>1D323D43-C27C-4AE2-B325-B075460BB74C</a:ObjectID>
<a:Name>writeToColumnList</a:Name>
<a:TemplateTargetItem.Value>.foreach_item(Parent.HistoryOfFieldsInTable.Columns)
   .//if(%DataType% == %Outer.DataType%)
%ObjectID%
   .//endif
.next(\n)</a:TemplateTargetItem.Value>
<a:CreationDate>1317209032</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478771995</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o140">
<a:ObjectID>AB1D2713-841F-4001-9BCC-23AF139517AD</a:ObjectID>
<a:Name>defaultWriteToHistory</a:Name>
<a:TemplateTargetItem.Value>.if(%WriteToColumn%)
false
.else
true
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1317209490</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317210193</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o141">
<a:ObjectID>53BE2542-C5EA-4DE2-8455-DC1C9A637E36</a:ObjectID>
<a:Name>writeColumnOfParentTableList</a:Name>
<a:TemplateTargetItem.Value>.if(%ForeignKey%)
   .foreach_item(ForeignKeyJoins.First.ParentTableColumn.Parent.Columns)
%ObjectID%
   .next(\n)
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317211387</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o142">
<a:ObjectID>328F2284-800D-4E80-B2EA-D94AF39D32C0</a:ObjectID>
<a:Name>FieldCode</a:Name>
<a:TemplateTargetItem.Value>.if (%Parent.HistoryOfFieldsTableCode%)
[%Parent.HistoryOfFieldsTableAdditionalCode%.]%Parent.Code%.%Code%
.else
[%Parent.HistoryOfFieldsTableAdditionalCode%.]%Code%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397635163</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397800326</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o143">
<a:ObjectID>7F9AC1EA-5C36-42A2-8747-2A183C5D9FD7</a:ObjectID>
<a:Name>FieldName</a:Name>
<a:TemplateTargetItem.Value>.if (%Parent.HistoryOfFieldsTableTitle%)
[%Parent.HistoryOfFieldsTableAdditionalTitle%/]%Parent.Comment%/%Comment%
.else
[%Parent.HistoryOfFieldsTableAdditionalTitle%/]%Comment%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397635163</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397800326</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o144">
<a:ObjectID>472D5417-712D-49DB-82EF-6AAA0791C03F</a:ObjectID>
<a:Name>Trigger_HistoryOfFieldsInTable_FieldCodeValue</a:Name>
<a:TemplateTargetItem.Value>.if (%ForeignKey%)
   .if (%WriteColumnOfParentTable%)
.set_value(value,&quot;case when %@1%v.%WriteColumnOfParentTable.Code% is null then Cast(%@1%.%Code% as nvarchar(100)) + N&#39;: Не указано&#39; else &quot;)
      .if (%WriteColumnOfParentTable.DataType% == &quot;datetime&quot;)
         .set_value(value,&quot;%value%Cast(%@1%.%Code% as nvarchar(100)) + N&#39;: &#39; + Convert(char(10), %@1%v.%WriteColumnOfParentTable.Code%, 104)&quot;)
      .elsif (%.L7:DataType% == &quot;varchar&quot;) or (%.L8:DataType% == &quot;nvarchar&quot;) or (%.L5:DataType% == &quot;nchar&quot;) or (%.L4:DataType% == &quot;char&quot;)
         .set_value(value,&quot;%value%Cast(%@1%.%Code% as nvarchar(100)) + N&#39;: &#39; + %@1%v.%WriteColumnOfParentTable.Code%&quot;)
      .else
         .set_value(value,&quot;%value%Cast(%@1%.%Code% as nvarchar(100)) + N&#39;: &#39; + Cast(%@1%v.%WriteColumnOfParentTable.Code% as nvarchar(max))&quot;)
      .endif
.set_value(value,&quot;%value% end&quot;)
   .else
      .set_value(value,&quot;Cast(%@1%.%Code% as nvarchar(100)) + N&#39;: &#39; + %@1%v.%GetUCGParentTableColumnName%&quot;)
   .endif
.elsif (%DataType% == &quot;bit&quot;)
   .set_value(value,case when %@1%.%Code% = 1 then N&#39;%TrueText%&#39; else N&#39;%FalseText%&#39; end)
.elsif (%DataType% == &quot;datetime&quot;)
   .set_value(value,&quot;Convert(char(10), %@1%.%Code%, 104)&quot;)
.elsif (%.L7:DataType% == &quot;varchar&quot;) or (%.L8:DataType% == &quot;nvarchar&quot;) or (%.L5:DataType% == &quot;nchar&quot;) or (%.L4:DataType% == &quot;char&quot;)
   .set_value(value,%@1%.%Code%)
.else
   .set_value(value,&quot;Cast(%@1%.%Code% as nvarchar(max))&quot;)
.endif
.if (%Parent.HistoryOfFieldsForAddAndDelete%)
case when %@1%.id is null then 
   .if (%@1% == &quot;i&quot;)
N&#39;Удалено&#39;
   .else
N&#39;Добавлено&#39;
   .endif
 when %@1%.\[%Code%] is null then N&#39;Не указано&#39; else %value% end
.else
coalesce(%value%, N&#39;Не указано&#39;)
.endif
.unset(value)</a:TemplateTargetItem.Value>
<a:CreationDate>1397635537</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478843548</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o145">
<a:ObjectID>6966CAEA-B3A3-4D16-91B0-7E378C665AC7</a:ObjectID>
<a:Name>WriteToColumnValue</a:Name>
<a:TemplateTargetItem.Value>.if (%Parent.HistoryOfFieldsForAddAndDelete%)
case when i.id is null then d.%Code% else i.%Code% end
.else
i.%Code%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397710009</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397710420</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o146">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>C967DE2C-8328-42BB-ABBB-CACB8F416096</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1317209490</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317210193</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o147">
<a:ObjectID>6E25EA0D-6197-4302-BF26-4252E0886174</a:ObjectID>
<a:Name>HistoryOfFieldsInTable</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;WriteToColumn&quot; AttributeID=&quot;{E5706A89-02ED-4CE7-9587-59A5175D6B9C}&quot; GrayHiddenAttributes=&quot;true&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
   &lt;ExtendedAttribute Attribute=&quot;WriteToHistory&quot; AttributeID=&quot;{3933A3C3-C954-4EB1-8669-5F7EF0AA87C3}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;true&quot; VerticalResize=&quot;true&quot; Display=&quot;Checkbox&quot; LeftText=&quot;No&quot; /&gt;
   &lt;GroupBox Name=&quot;GroupBox2&quot; Caption=&quot;ForeignKey&quot; ControlAsLabel=&quot;No&quot; &gt;
      &lt;ExtendedAttribute Attribute=&quot;WriteToColumnByForeignKey&quot; AttributeID=&quot;{21A380A0-AC9D-409C-8C43-72C1A5A6C573}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; HorizontalResize=&quot;Yes&quot; Display=&quot;Combobox&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;WriteColumnOfParentTable&quot; AttributeID=&quot;{D1FF9D95-E370-47A6-ACF8-5114927CBA77}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; HorizontalResize=&quot;Yes&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;WriteToColumnByForeignKey2&quot; AttributeID=&quot;{14810749-A334-4737-AB6A-6D288DB765C6}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; Display=&quot;Combobox&quot; LeftText=&quot;false&quot; /&gt;
      &lt;ExtendedAttribute Attribute=&quot;WriteColumnOfParentTable2&quot; AttributeID=&quot;{7C0BC7B3-2D44-48BB-89C5-A2794DD5CF46}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; Display=&quot;Combobox&quot; LeftText=&quot;false&quot; /&gt;
   &lt;/GroupBox&gt;
   &lt;GroupBox Name=&quot;GroupBox1&quot; Caption=&quot;BooleanText&quot; ControlAsLabel=&quot;No&quot; &gt;
      &lt;HorizontalLayout Name=&quot;HorizontalLayout1&quot; &gt;
         &lt;ExtendedAttribute Attribute=&quot;TrueText&quot; AttributeID=&quot;{24CB9DF2-EC64-4C7F-A551-D1456F0352F5}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
         &lt;ExtendedAttribute Attribute=&quot;FalseText&quot; AttributeID=&quot;{11EDA5B0-D9F8-444D-82EC-AF2BF79D8978}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; LineNumber=&quot;3&quot; HorizontalResize=&quot;Yes&quot; VerticalResize=&quot;true&quot; LeftText=&quot;false&quot; /&gt;
      &lt;/HorizontalLayout&gt;
   &lt;/GroupBox&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1317209490</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478771995</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o148">
<a:TypePublicName>CriterionTargetItem</a:TypePublicName>
<a:ObjectID>46F247B4-3CCE-4D32-9F53-3FC6A9393389</a:ObjectID>
<a:Name>Criteria</a:Name>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317211387</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:CriterionTargetItem Id="o149">
<a:ObjectID>FC681600-3CA3-4463-9719-81C128D4F1CB</a:ObjectID>
<a:Name>ForeignKey</a:Name>
<a:CriterionTargetItem.Value>(%ForeignKey%)</a:CriterionTargetItem.Value>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397710420</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:ParentCriterion>
<o:CriterionTargetItem Ref="o131"/>
</c:ParentCriterion>
<c:Categories>
<o:TypedCategoryTargetItem Id="o150">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>11C39890-ADEA-4F1D-8620-5B059209C585</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612895</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o151">
<a:ObjectID>D1FF9D95-E370-47A6-ACF8-5114927CBA77</a:ObjectID>
<a:Name>WriteColumnOfParentTable</a:Name>
<a:CreationDate>1317210824</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1317211556</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%writeColumnOfParentTableList%</a:ExtendedAttributeTargetItem.ListOfValues>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:ValidateDataType>0</a:ValidateDataType>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o137"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o152">
<a:ObjectID>801731E5-AEB7-480C-82B1-E999853B34F1</a:ObjectID>
<a:Name>GetUCGParentTableColumnName</a:Name>
<a:CreationDate>1397642028</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397728517</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   %Get% = obj.EvaluateTextFor(&quot;%GetParentTable.NameColumnOriginal%&quot;, &quot;UserControlsGenerator&quot;)
   if %Get% = &quot;&quot; then %Get% = obj.EvaluateTextFor(&quot;%GetParentTable.NameColumn%&quot;, &quot;UserControlsGenerator&quot;)
End Function</a:GetMethodScript>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o153">
<a:ObjectID>21A380A0-AC9D-409C-8C43-72C1A5A6C573</a:ObjectID>
<a:Name>WriteToColumnByForeignKey</a:Name>
<a:CreationDate>1397709436</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397709991</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%writeToColumnList%</a:ExtendedAttributeTargetItem.ListOfValues>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:ExtendedAttributeTargetItem.Complete>1</a:ExtendedAttributeTargetItem.Complete>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o154"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o155">
<a:ObjectID>7C0BC7B3-2D44-48BB-89C5-A2794DD5CF46</a:ObjectID>
<a:Name>WriteColumnOfParentTable2</a:Name>
<a:CreationDate>1467612008</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478772048</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%writeColumnOfParentTable2List%</a:ExtendedAttributeTargetItem.ListOfValues>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o156"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o157">
<a:ObjectID>14810749-A334-4737-AB6A-6D288DB765C6</a:ObjectID>
<a:Name>WriteToColumnByForeignKey2</a:Name>
<a:CreationDate>1467612735</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612904</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.ListOfValues>%writeToColumnList%</a:ExtendedAttributeTargetItem.ListOfValues>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:ExtendedAttributeTargetItem.Complete>1</a:ExtendedAttributeTargetItem.Complete>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o158"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o159">
<a:TypePublicName>ExtendedCollectionTargetItem</a:TypePublicName>
<a:ObjectID>293E113E-4CCA-4094-A137-45A3413B1B49</a:ObjectID>
<a:Name>Extended Collections</a:Name>
<a:CreationDate>1397709436</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612895</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedCollectionTargetItem Id="o154">
<a:ObjectID>D2843677-CE3D-41E3-8EAB-4FDD0D357890</a:ObjectID>
<a:Name>WriteToColumnByForeignKey</a:Name>
<a:CreationDate>1397709436</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397709991</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80 DTTP 60</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
<o:ExtendedCollectionTargetItem Id="o156">
<a:ObjectID>4FE05694-ACA9-421C-958C-243D00C0A61A</a:ObjectID>
<a:Name>WriteColumnOfParentTable2</a:Name>
<a:CreationDate>1467612008</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612726</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80 DTTP 60</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
<o:ExtendedCollectionTargetItem Id="o158">
<a:ObjectID>E1B3FD98-EBCA-41A5-A9BD-5E907100C3A6</a:ObjectID>
<a:Name>WriteToColumnByForeignKey2</a:Name>
<a:CreationDate>1467612735</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612895</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:DestinationClassID>6081657A-C285-44EE-B3B4-D98595A05C31</a:DestinationClassID>
<a:DefaultColumnFilter>NAME 80 CODE 80 DTTP 60</a:DefaultColumnFilter>
</o:ExtendedCollectionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o160">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>B2EA8182-322F-4006-89E5-EB1103F921F3</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1397710009</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467613298</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o161">
<a:ObjectID>98FAA40C-9E94-4B19-8A7A-68DADA2EE651</a:ObjectID>
<a:Name>WriteToColumnByForeignKeyValue</a:Name>
<a:TemplateTargetItem.Value>.if (%Parent.HistoryOfFieldsForAddAndDelete%)
case when i%Code%.id is null then d%Code%.%WriteColumnOfParentTable.Code% else i%Code%.%WriteColumnOfParentTable.Code% end
.else
i%Code%.%WriteColumnOfParentTable.Code%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397710009</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397710649</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o162">
<a:ObjectID>E4A23E21-FA2B-4A23-B93A-88A03DEFCEAD</a:ObjectID>
<a:Name>writeColumnOfParentTable2List</a:Name>
<a:TemplateTargetItem.Value>.if (%WriteColumnOfParentTable%)
   .if (%WriteColumnOfParentTable.ForeignKey%)
      .foreach_item(WriteColumnOfParentTable.ForeignKeyJoins.First.Parent.ParentTable.Columns)
%ObjectID%
      .next(\n)
   .endif
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1467612086</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467612733</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o163">
<a:ObjectID>38532933-9634-4AB1-B379-16C8EB0F00AA</a:ObjectID>
<a:Name>WriteToColumnByForeignKeyValue2</a:Name>
<a:TemplateTargetItem.Value>.if (%Parent.HistoryOfFieldsForAddAndDelete%)
case when i%Code%2.id is null then d%Code%2.%WriteColumnOfParentTable2.Code% else i%Code%2.%WriteColumnOfParentTable2.Code% end
.else
i%Code%2.%WriteColumnOfParentTable2.Code%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1467613232</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1467613298</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:CriterionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:CriterionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o164">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>DB524339-6525-482F-8DCD-595731E0CFC9</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1397706983</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397707334</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o165">
<a:ObjectID>24CB9DF2-EC64-4C7F-A551-D1456F0352F5</a:ObjectID>
<a:Name>TrueText</a:Name>
<a:CreationDate>1397706983</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397707334</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.Value>Да</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o166">
<a:ObjectID>11EDA5B0-D9F8-444D-82EC-AF2BF79D8978</a:ObjectID>
<a:Name>FalseText</a:Name>
<a:CreationDate>1397706983</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397707334</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.Value>Нет</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o167">
<a:ObjectID>D9074E3D-10BC-45C5-99B7-AA5F400A9DFF</a:ObjectID>
<a:Name>ExtendedObject</a:Name>
<a:CreationDate>1350617262</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350617474</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o168">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>9AF5B93A-04A4-4C98-A714-B3AAB5ACEE7C</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1350617262</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350617474</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o169">
<a:ObjectID>E627C8F8-1681-4426-8C1D-0AD70DCCE5E0</a:ObjectID>
<a:Name>TableNames</a:Name>
<a:TemplateTargetItem.Value>SELECT N&#39;%Code%&#39; as Code, N&#39;%Name%&#39; as Name, N&#39;%SQLComment%&#39; as Comment, &#39;%Package.Code%&#39; as PackageCode, &#39;%Package.Name%&#39; as PackageName, &#39;%Package.SQLComment%&#39; as PackageComment</a:TemplateTargetItem.Value>
<a:CreationDate>1350617262</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1350617474</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o170">
<a:ObjectID>E36F40C2-41E0-4108-9525-D03F50B9790A</a:ObjectID>
<a:Name>Column</a:Name>
<a:CreationDate>1351144062</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o171">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>43810347-420B-4ACC-BCCF-B4FF255D059A</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1351144062</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351144831</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o172">
<a:ObjectID>54547409-A89F-47CF-B96A-2EA60430EF34</a:ObjectID>
<a:Name>CreateReferenceToTable</a:Name>
<a:CreationDate>1351144016</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351145045</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>15</a:ExtendedAttributeTargetItem.DataType>
<a:DestinationClassID>380BAA40-0042-11D2-BD28-00A02478ECC9</a:DestinationClassID>
<a:ValidateDataType>0</a:ValidateDataType>
<c:ExtendedCollection>
<o:ExtendedCollectionTargetItem Ref="o173"/>
</c:ExtendedCollection>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o174">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>4D4ECCA0-2072-4F17-9AA4-F56C43BE296A</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>1351144980</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351145045</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o175">
<a:ObjectID>1ED5F216-F0FB-4978-A488-934750BC37EA</a:ObjectID>
<a:Name>CreateReferenceToTable</a:Name>
<a:CreationDate>1351144980</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351145455</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim value
   set value = GetShortcutObject(obj.GetExtendedAttribute(&quot;CreateReferenceToTable&quot;))
   
   if value is nothing then exit sub
   if value.PrimaryKey.Columns.Count = 0 then exit sub

   dim reference, referenceJoin
   dim name

   set reference = value.Package.References.CreateNew()

   name = &quot;TableRef_&quot; &amp; obj.Parent.Code &amp; &quot;_&quot; &amp; obj.Code
   reference.Name = name
   reference.Code = name

   set referenceJoin = reference.Joins.CreateNew()
   
   set referenceJoin.ParentTableColumn = value.PrimaryKey.Columns.Item(0)
   set referenceJoin.ChildTableColumn = obj
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o176">
<a:TypePublicName>ExtendedCollectionTargetItem</a:TypePublicName>
<a:ObjectID>038EC7AF-F6BA-47C0-92F6-F1D7BA2416FA</a:ObjectID>
<a:Name>Extended Collections</a:Name>
<a:CreationDate>1351144980</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351145045</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedCollectionTargetItem Id="o173">
<a:ObjectID>6E7DE47B-DE01-4178-A814-6143EB5BE76A</a:ObjectID>
<a:Name>CreateReferenceToTable</a:Name>
<a:CreationDate>1351144980</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1351145045</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:ExtendedCollectionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o177">
<a:TypePublicName>CriterionTargetItem</a:TypePublicName>
<a:ObjectID>FC10BD14-A0C1-41FC-B3C2-EAA35FFC081A</a:ObjectID>
<a:Name>Criteria</a:Name>
<a:CreationDate>1397629501</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639270</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:CriterionTargetItem Id="o178">
<a:ObjectID>B73015C9-04C5-4BD7-80EE-E7DCD812E489</a:ObjectID>
<a:Name>HistoryOfFieldsInTableAndForeignKey</a:Name>
<a:CriterionTargetItem.Value>(%Parent.HistoryOfFieldsInTableFilled%) and (%ForeignKey%)</a:CriterionTargetItem.Value>
<a:CreationDate>1397629501</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639380</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o179">
<a:TypePublicName>MenuTargetItem</a:TypePublicName>
<a:ObjectID>FC373773-7F97-4E2B-B9AB-8D4547B78B1B</a:ObjectID>
<a:Name>Menus</a:Name>
<a:CreationDate>1397639247</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639270</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MenuTargetItem Id="o180">
<a:ObjectID>CD76BAB1-2BB7-478D-86E8-F4E243F321D9</a:ObjectID>
<a:Name>Menu_1</a:Name>
<a:MenuTargetItem.Value>&lt;Menu&gt;
   &lt;Command Name=&quot;SetNameOrNameRu&quot; Caption=&quot;SetNameOrNameRu&quot; /&gt;
&lt;/Menu&gt;
</a:MenuTargetItem.Value>
<a:CreationDate>1397629843</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639270</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:MenuTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o181">
<a:TypePublicName>MethodTargetItem</a:TypePublicName>
<a:ObjectID>4239CE04-A730-4E7B-99D8-67B123704679</a:ObjectID>
<a:Name>Methods</a:Name>
<a:CreationDate>1397639247</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639270</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:MethodTargetItem Id="o182">
<a:ObjectID>A5FE712D-6248-418D-8A57-ABE51447A91B</a:ObjectID>
<a:Name>SetNameOrNameRu</a:Name>
<a:CreationDate>1397629501</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397639460</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   dim i, column, table
   
   if obj.ForeignKeyJoins.Count = 0 then exit sub
   
   set table = GetShortcutObject(obj.ForeignKeyJoins.Item(0).ParentTableColumn.Parent)
   
   for i = 0 to table.Columns.Count - 1
      set column = table.Columns.Item(i)
      if column.Code = &quot;Name&quot; or column.Code = &quot;name&quot; or column.Code = &quot;NameRu&quot; or column.Code = &quot;nameRu&quot; or column.Code = &quot;FullNameRu&quot; or column.Code = &quot;Fio_Ru&quot; then
         if column.Package.ObjectID &lt;&gt; obj.Package.ObjectID then
            msgbox &quot;Found shortcut of column &quot; + column.Code
            set column = column.CreateShortcut(obj.Package)
         else
            msgbox &quot;Found column &quot; + column.Code
         end if
         
         obj.SetExtendedAttribute &quot;WriteColumnOfParentTable&quot;, column
         exit sub
      end if
   next
End Sub</a:MethodScript>
</o:MethodTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:CriterionTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o183">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>0737D594-C393-4822-B3B0-E45662FF7B13</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o184">
<a:ObjectID>893B9B64-5A79-4156-8003-18580D67571A</a:ObjectID>
<a:Name>GetParentTable</a:Name>
<a:TemplateTargetItem.Value>.if (%ForeignKey%)
%ForeignKeyJoins.First.ParentTableColumn.Parent%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478772841</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o185">
<a:ObjectID>7EFD08E8-4A68-4C3A-B772-4601F736A49D</a:ObjectID>
<a:Name>GetParentTableColumn</a:Name>
<a:TemplateTargetItem.Value>.if (%ForeignKey%)
%ForeignKeyJoins.First.ParentTableColumn%
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1478772894</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o186">
<a:ObjectID>0BB83760-7C2E-4280-89BA-E0A4CA37C8D9</a:ObjectID>
<a:Name>SQLScript_AlterColumn</a:Name>
<a:TemplateTargetItem.Value>.if (%ComputedExpression% == &quot;&quot;)
-- alter column %Code%
alter table %Parent.Code%
   alter column %Code% %DataType% 
   .if(%Mandatory%)
not null
   .else
null
   .endif

GO
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o187">
<a:ObjectID>3CF2170B-E099-4408-88A7-DFCB4B962E26</a:ObjectID>
<a:Name>SQLScript_AlterColumnReferences</a:Name>
<a:TemplateTargetItem.Value>.if (%ForeignKey%)
   .foreach_item(ForeignKeyJoins)
%Reference.Preview%
   .next(\n\n)
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o188">
<a:ObjectID>E1199F24-C191-4270-940C-75F8F5079CFB</a:ObjectID>
<a:Name>SQLScript_CreateColumn</a:Name>
<a:TemplateTargetItem.Value>-- create column %Code%
if not exists (
	select 1 
	from sys.sysobjects o 
		join sys.syscolumns c on o.id=c.id 
	where c.name=&#39;%Code%&#39; and o.name=&#39;%Parent.Code%&#39;) 
alter table %Parent.Code%
   add %Code% 
.if (%ComputedExpression% == &quot;&quot;)
%DataType% 
   .if(%Mandatory%)
not null
   .else
null
   .endif
   .if(%DefaultValue% != &quot;&quot;)
 constraint DF__%Parent.Code%__%Code% default(%DefaultValue%)
   .endif
.else
AS (%ComputedExpression%)
.endif

GO</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o189">
<a:ObjectID>F02A25E8-575A-410E-9AF7-7020DA11A29D</a:ObjectID>
<a:Name>SQLScript_CreateDefault</a:Name>
<a:TemplateTargetItem.Value>.if(%DefaultValue% != &quot;&quot;)
-- create default value for column %Code%
IF  EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N&#39;[DF__%Parent.Code%__%Code%]&#39;) AND type = &#39;D&#39;)
	ALTER TABLE %Parent.Code% DROP CONSTRAINT [DF__%Parent.Code%__%Code%]
GO

ALTER TABLE %Parent.Code% ADD CONSTRAINT DF__%Parent.Code%__%Code% DEFAULT (%DefaultValue%) FOR [%Code%]
GO
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o190">
<a:ObjectID>427BE566-3FD0-4515-938C-DD9E232CB698</a:ObjectID>
<a:Name>SQLScript_DropColumn</a:Name>
<a:TemplateTargetItem.Value>.if (%ComputedExpression% != &quot;&quot;)
-- drop column %Code%
alter table %Parent.Code%
   drop column %Code% 
GO
.endif</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o191">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>64D360FE-CC2C-4045-A5DE-0A2DDA146CDA</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o192">
<a:ObjectID>4EB9FC6D-AFCC-4A70-A9FC-4C43B9645DA5</a:ObjectID>
<a:Name>AlterColumn</a:Name>
<a:TemplateTargetItem.Value>%SQLScript_DropColumn%

%SQLScript_CreateColumn%

%SQLScript_AlterColumn%

%SQLScript_CreateDefault%</a:TemplateTargetItem.Value>
<a:CreationDate>1490506923</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1490507062</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:GeneratedFileTargetItem.Encoding>UTF8Marked</a:GeneratedFileTargetItem.Encoding>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o193">
<a:ObjectID>50E287A6-6667-4CD3-BBCF-1DE2B450B645</a:ObjectID>
<a:Name>Procedure</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o194">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>09949E90-8EB1-4716-85CC-F7C18B87AEAF</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o195">
<a:ObjectID>78396794-0C1A-494B-8A1D-9AA12CC6BB91</a:ObjectID>
<a:Name>CopyrightCompanyName</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.DataType>12</a:ExtendedAttributeTargetItem.DataType>
<a:ExtendedAttributeTargetItem.Value>%Package.CopyrightCompanyName%</a:ExtendedAttributeTargetItem.Value>
<a:Template>1</a:Template>
<a:ValidateDataType>0</a:ValidateDataType>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o196">
<a:TypePublicName>FormTargetItem</a:TypePublicName>
<a:ObjectID>3C6509C7-AC85-45D0-9D8D-10630B6F961E</a:ObjectID>
<a:Name>Forms</a:Name>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:FormTargetItem Id="o197">
<a:ObjectID>BCEBF50B-5289-47B3-ACCC-673FD7754F7C</a:ObjectID>
<a:Name>JazzSoft SqlScripts</a:Name>
<a:FormTargetItem.Value>&lt;Form  &gt;
   &lt;ExtendedAttribute Attribute=&quot;CopyrightCompanyName&quot; AttributeID=&quot;{78396794-0C1A-494B-8A1D-9AA12CC6BB91}&quot; GrayHiddenAttributes=&quot;Yes&quot; SizeInChars=&quot;1&quot; HorizontalResize=&quot;Yes&quot; /&gt;
&lt;/Form&gt;
</a:FormTargetItem.Value>
<a:CreationDate>1364446270</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1364446554</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:FormTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o198">
<a:ObjectID>A0E6FFE4-BCC8-453B-87E8-2BBE46745EA5</a:ObjectID>
<a:Name>View</a:Name>
<a:CreationDate>1369296396</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1369296682</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:EnableSelectionGeneration>1</a:EnableSelectionGeneration>
<c:Categories>
<o:TypedCategoryTargetItem Id="o199">
<a:TypePublicName>GeneratedFileTargetItem</a:TypePublicName>
<a:ObjectID>8C62BC2E-FEEB-4287-A726-019D302F6D1B</a:ObjectID>
<a:Name>Generated Files</a:Name>
<a:CreationDate>1369296396</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1369296682</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:GeneratedFileTargetItem Id="o200">
<a:ObjectID>8B409A5B-FA01-45F0-9323-936ED9DC52BD</a:ObjectID>
<a:Name>SqlPreview</a:Name>
<a:TemplateTargetItem.Value>if exists (select 1
            from  sysobjects
           where  id = object_id(&#39;%Code%&#39;)
            and   type = &#39;V&#39;)
   drop view %Code%
go

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*==============================================================*/
/* View: %Code% */
/*==============================================================*/
create view %Code% as
%SQLQuery%
go

.foreach_item(Triggers,\n\n,\n)
if exists (select 1
          from sysobjects
          where id = object_id(&#39;%Code%&#39;)
          and type = &#39;TR&#39;)
   drop trigger %Code%
go

%TextPreview%
go
.next(\n\n)

.foreach_item(Indexes,\n\n,\n)
%Preview%
.next(\n\n)</a:TemplateTargetItem.Value>
<a:CreationDate>1369296396</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1398251520</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:FileType>.sql</a:FileType>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:GeneratedFileTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
<o:MetaClassTargetItem Id="o201">
<a:ObjectID>D3C939D1-6E8F-407B-A67C-F93BC735A881</a:ObjectID>
<a:Name>ViewColumn</a:Name>
<a:CreationDate>1397715682</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716029</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TypedCategoryTargetItem Id="o202">
<a:TypePublicName>ExtendedAttributeTargetItem</a:TypePublicName>
<a:ObjectID>DBF37B33-9A8B-43A3-A6BA-1418711EF31A</a:ObjectID>
<a:Name>Extended Attributes</a:Name>
<a:CreationDate>1397715682</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716061</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:ExtendedAttributeTargetItem Id="o203">
<a:ObjectID>3FFB06D6-D60F-4F8C-B4F0-02DE72031158</a:ObjectID>
<a:Name>ForeignKey</a:Name>
<a:CreationDate>1397715682</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397715855</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:Computed>1</a:Computed>
<a:ComputedAccessType>RO</a:ComputedAccessType>
<a:GetMethodScript>Function %Get%(obj)
   %Get% = obj.ChildViewReferenceJoins.Count &gt; 0
End Function</a:GetMethodScript>
</o:ExtendedAttributeTargetItem>
<o:ExtendedAttributeTargetItem Id="o204">
<a:ObjectID>51BFBC3B-3261-4C1A-A987-A30AC0A3F00C</a:ObjectID>
<a:Name>Mandatory</a:Name>
<a:CreationDate>1397716052</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716061</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:ExtendedAttributeTargetItem.Value>false</a:ExtendedAttributeTargetItem.Value>
</o:ExtendedAttributeTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
<o:TypedCategoryTargetItem Id="o205">
<a:TypePublicName>TemplateTargetItem</a:TypePublicName>
<a:ObjectID>B407CA0A-DDF1-44D0-AEFE-601ADC2B20CE</a:ObjectID>
<a:Name>Templates</a:Name>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716029</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<c:Categories>
<o:TemplateTargetItem Id="o206">
<a:ObjectID>C52454C5-DEF2-4BB0-906B-87EDC3633B20</a:ObjectID>
<a:Name>GetParentTable</a:Name>
<a:TemplateTargetItem.Value>%ChildViewReferenceJoins.First.Column1.Parent%</a:TemplateTargetItem.Value>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716029</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
<o:TemplateTargetItem Id="o207">
<a:ObjectID>EC24682F-460F-46E3-9F63-072400033928</a:ObjectID>
<a:Name>GetParentTableColumn</a:Name>
<a:TemplateTargetItem.Value>%ChildViewReferenceJoins.First.Column1%</a:TemplateTargetItem.Value>
<a:CreationDate>1397715859</a:CreationDate>
<a:Creator>Sergey.Shpakovskiy</a:Creator>
<a:ModificationDate>1397716029</a:ModificationDate>
<a:Modifier>Sergey.Shpakovskiy</a:Modifier>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
</o:TemplateTargetItem>
</c:Categories>
</o:TypedCategoryTargetItem>
</c:Categories>
</o:MetaClassTargetItem>
</c:Categories>
</o:ProfileTargetItem>
</c:Categories>
</o:ExtendedModelDefinition>

</EXASET>